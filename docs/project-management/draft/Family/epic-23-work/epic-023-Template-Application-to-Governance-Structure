# EPIC-023: Template Application to Governance Structure

> **Note:** This Epic enables automatic application of advisor-provided templates to Family Governance elements on Family Portal

---

## üìã Basic Information

**Issue Type:** Epic  
**Project:** FG  
**Epic Name:** Template Application to Governance Structure  
**Summary:** Enable Family Council to accept templates received from External Advisors and automatically apply their content to corresponding Family Governance structure elements on Family Portal  
**Parent User Journey:** [To be determined]  
**Parent Initiative:** N/A  
**Priority:** Critical  
**Target Release:** 30.11.2025  
**Epic Link:** FG-EPIC-023  

**Related Epics:**
- EPIC-008: Constitution Management System
- EPIC-009: Learning Paths Platform  
- EPIC-010: Committee Structure Management
- EPIC-017: Template Library Foundation
- EPIC-018: Template Creation & Editing
- EPIC-019: Template Versioning
- EPIC-020: Template Marketplace
- EPIC-021: Template Discovery & Search
- EPIC-022: Constitution Template Exchange (Family & Advisor) - **DIRECT DEPENDENCY**

---

## üéØ Epic Goal

**What will this Epic deliver?**

Enable Family Council members to review templates received from external advisors (hired through marketplace) and, upon acceptance, automatically apply all template content to the corresponding Family Governance structure elements on the Family Portal.

**Business Problem:**

After receiving improved governance templates from external advisors (EPIC-022), families currently have no efficient way to apply the proposed structures to their active Family Portal. Manual copying is time-consuming, error-prone, and doesn't preserve the advisor's carefully crafted structure, relationships, and best practices embedded in the template.

**Proposed Solution:**

Provide a streamlined workflow where Family Council can:
1. Preview received template with full content visibility
2. Compare template structure with current governance setup
3. Choose application strategy (replace, merge, or manual conflict resolution)
4. Trigger automatic application with real-time progress tracking
5. Review all applied changes with before/after comparison
6. Undo application within 24-hour grace period if needed

**Business Value:**

- **Accelerate governance improvement:** Reduce template implementation time from hours/days to minutes
- **Preserve advisor expertise:** Ensure advisor's structural recommendations are applied correctly
- **Reduce errors:** Eliminate manual copy-paste mistakes
- **Increase advisor value:** Make advisor services more impactful and measurable
- **Enable rapid governance evolution:** Families can iterate on governance structure quickly

**Scope Boundaries:**

**IN SCOPE:**
- Preview and comparison of received templates
- Automatic application of template content to governance elements
- Conflict detection and resolution workflows
- Progress tracking during application
- Changes review and verification
- 24-hour undo capability
- Notifications for application lifecycle

**OUT OF SCOPE:**
- Editing template content after receipt (covered in EPIC-022)
- Creating new templates from scratch (covered in EPIC-018)
- Sending templates back to advisor (covered in EPIC-022)
- Partial/selective application of template sections (future consideration)
- Version control for applied templates (future consideration)

---

## üë• Target Users

### Primary Persona

**Family Council Member (Viktor Petrov)**
- 52, Controlling Owner & Family Council Chair
- Hired external advisor through marketplace to improve governance
- Received advisor's comprehensive governance template
- Needs to implement advisor's recommendations efficiently
- Wants to understand impact before committing to changes
- Requires ability to review and potentially revert changes

**Key Goals:**
- Apply advisor's template quickly without manual work
- Understand what will change before accepting
- Preserve important existing family content
- Verify that application was successful

### Secondary Personas

**External Advisor (Sarah Chen)**
- 45, Family Governance Consultant
- Created comprehensive governance template for client
- Wants to ensure her structure is implemented correctly
- Expects seamless application process
- Needs confirmation when family applies template

**Family Member (Maria Petrova)**  
- 28, Next Generation, Committee Member
- Participates in family governance activities
- Affected by governance structure changes
- Expects clear communication about updates
- Wants smooth transition to new structure

---

## üìñ User Stories (High-Level)

**US-1: View Received Template**
As a Family Council, I want to view the complete template received from my External Advisor, so that I can understand the proposed governance structure before applying it.

**US-2: Compare Template with Current Structure**
As a Family Council, I want to see side-by-side comparison of the template versus my current governance structure, so that I can understand what will change if I accept the template.

**US-3: Configure Application Options**
As a Family Council, I want to configure how the template should be applied (replace/merge/manual), so that I have control over what changes are made to my governance structure.

**US-4: Accept and Apply Template**
As a Family Council, I want to accept the template and trigger automatic application to my governance structure, so that advisor's recommendations are implemented without manual work.

**US-5: Monitor Application Progress**
As a Family Council, I want to monitor the template application process in real-time, so that I know when the update is complete and can verify results.

**US-6: Review Applied Changes**
As a Family Council, I want to review all changes made by template application with before/after comparison, so that I can verify the governance structure was updated correctly.

**US-7: Resolve Content Conflicts**
As a Family Council, I want to manually resolve conflicts when template content differs from existing content, so that I can make informed decisions about which content to keep.

**US-8: Undo Template Application**
As a Family Council, I want to undo all changes if template application doesn't meet my expectations, so that I can revert to my previous governance structure.

**US-9: Receive Application Notifications**
As a Family Council and External Advisor, I want to receive notifications about template application lifecycle events, so that I stay informed about the implementation progress.

---

## üîó Dependencies

### Upstream Dependencies (Must Complete First)

| Epic/Service | Dependency Description | Status | Impact |
|--------------|------------------------|--------|--------|
| **EPIC-022** | Template Exchange System | üî¥ Required | Cannot apply templates without exchange mechanism |
| Constitution Service | Governance structure data models | ‚úÖ Exists | Need API endpoints for bulk updates |
| Template Service | Template format specification | ‚úÖ Exists | Must support all template types |
| Family Service | Family member permissions | ‚úÖ Exists | Required for access control |

### Related Epics (Parallel/Informational)

| Epic | Relationship | Notes |
|------|--------------|-------|
| EPIC-008 | Constitution structure | Application target for constitution templates |
| EPIC-009 | Learning Paths | Application target for learning path templates |
| EPIC-010 | Committee Structure | Application target for committee templates |
| EPIC-017-021 | Template ecosystem | Source of template formats and standards |

### Technical Dependencies

- **Database:** Schema support for template application transactions, rollback capability
- **API:** Bulk update endpoints for governance elements
- **Storage:** Backup system for pre-application state
- **Queue:** Background job processing for long-running applications
- **Cache:** Invalidation strategy after structure updates

---

## üé® Design & UX

### User Flows

**Flow 1: Standard Application (No Conflicts)**
```
1. Receive notification: "Advisor sent updated template"
2. Click notification ‚Üí Open template preview
3. Review template content (all sections visible)
4. Click "Compare with Current" ‚Üí See side-by-side diff
5. Review changes: üü¢ New | üîµ Modified | ‚ö™ Unchanged
6. Click "Accept & Apply Template"
7. Confirm in modal with summary of changes
8. Watch progress bar: Validating ‚Üí Creating ‚Üí Updating ‚Üí Finalizing
9. Success message: "Template applied successfully"
10. View Changes Summary with before/after comparisons
```

**Flow 2: Application with Conflicts**
```
1-6. [Same as Flow 1]
7. System detects conflicts ‚Üí Enters conflict resolution mode
8. Review conflicts one-by-one:
   - See current content (left) vs template content (right)
   - Choose: Keep Current | Use Template | Merge Both
9. After resolving all conflicts, click "Apply Resolutions"
10. Continue with normal application flow
```

**Flow 3: Undo Application**
```
1. Within 24 hours after application
2. Navigate to Template History or Changes Summary
3. Click "Undo Template Application"
4. Confirm: "This will restore previous version"
5. System reverts all changes
6. Success: "Governance structure restored to previous state"
7. Optional: Notify advisor that template was unapplied
```

### Key Screens (Figma: TBD)

**Screen 1: Template Preview**
- Template type, title, description
- Advisor's message explaining the template
- Preview of all sections/modules/components
- "Compare with Current" and "Accept & Apply" buttons

**Screen 2: Comparison View**
- Split screen: Current (left) vs Template (right)
- Color-coded differences (green/blue/red)
- Statistics: X sections added, Y modified, Z unchanged
- "Configure Application" button

**Screen 3: Application Configuration**
- Application mode options (Replace/Merge/Manual)
- Conflict resolution strategy (Template priority/Current priority/Manual review)
- Preserve options (members/dates/notes/attachments)
- "Continue to Review" button

**Screen 4: Progress Tracker**
- Overall progress bar (0-100%)
- Step-by-step checklist with current status
- Estimated time remaining
- Error handling with retry option

**Screen 5: Changes Summary**
- Change log with timestamps
- Filterable list (type, action, date)
- Before/after preview for each change
- "Undo All Changes" button (24h window)
- "Export Report" button

---

## üîî Notifications

| Trigger Event | Recipient | Channel | Timing | Content |
|--------------|-----------|---------|--------|---------|
| Template received from advisor | Family Council | In-app + Email | Immediate | "Advisor [Name] sent updated governance template for review" |
| Template application started | Family Council | In-app | Immediate | "Applying template to your governance structure..." |
| Template application completed | Family Council + Advisor | In-app + Email | On completion | "Template applied successfully. [X] sections updated." |
| Template application failed | Family Council | In-app + Email | On error | "Template application failed. [Error details]. Retry available." |
| Conflicts detected during application | Family Council | In-app | Real-time | "[X] conflicts require your review before proceeding" |
| Template application undone | Advisor (optional) | In-app + Email | Immediate | "Family [Name] reverted the template application" |

---

## üßÆ Business Rules

### Access & Permissions
1. **Only Family Council members** can accept and apply templates
2. **Family Council Chair** has override authority for all application decisions
3. **External Advisor** receives read-only notification when template is applied/undone
4. **Other family members** see updated governance structure after application completes

### Application Process
5. Template application is **atomic transaction** (all-or-nothing)
6. System creates **automatic backup** before application starts
7. Application **locks affected governance elements** during processing (read-only mode)
8. If application fails mid-process, system **automatically rolls back** to backup
9. Maximum application time: **10 minutes** (timeout with error notification)

### Conflict Resolution
10. System automatically detects conflicts when template content differs from existing content
11. **Conflict resolution strategies:**
    - **Replace:** Template content overwrites existing (default for empty/placeholder content)
    - **Merge:** Combines template and existing content (default for substantive content)
    - **Manual:** User chooses for each conflict individually
12. User can change resolution strategy at any time before final confirmation

### Undo & Rollback
13. **24-hour grace period** for undo after successful application
14. Undo restores **exact previous state** (no partial undo)
15. Undo creates **archived copy** of applied template version for reference
16. After 24 hours, undo becomes unavailable (permanent application)
17. Only **one undo per application** (cannot redo after undo)

### Data Integrity
18. System validates template format before application
19. All foreign key relationships are maintained during application
20. User permissions and access controls are updated automatically
21. Version history is preserved for all modified governance elements

### Notifications & Communication
22. Family Council receives notification at each major application milestone
23. Advisor receives notification only when application completes or is undone
24. Application progress is **visible in real-time** to initiating user
25. Email notifications sent only for **completed, failed, or undone** events (not progress updates)

---

## üìù Notes

### Assumptions
- Templates received from advisors follow standardized format established in EPIC-022
- Template content is valid and properly formatted (validation done in EPIC-022)
- Family Council has already reviewed and approved advisor's work before applying
- Existing governance structure has unique identifiers for mapping to template elements

### Constraints
- Application process must complete within 10 minutes to prevent timeout
- System must maintain data consistency even if partial application occurs
- Cannot apply multiple templates simultaneously (queue if multiple pending)
- Browser/network interruptions should not corrupt governance data

### Technical Considerations
- Large templates (100+ sections) may require background processing
- Real-time progress updates use WebSocket connections
- Backup storage requires 2x current governance data size
- Conflict detection algorithm must be efficient for large structures

### Future Enhancements (Out of Scope)
- **Partial application:** Apply only selected sections of template
- **Scheduled application:** Apply template at specific future date/time
- **A/B testing:** Test template changes with subset of family before full rollout
- **Version comparison:** Compare multiple template versions before choosing
- **Collaborative review:** Multiple Family Council members review together
- **AI-assisted conflict resolution:** Smart suggestions for conflict resolution

### Open Questions
- Should system notify all family members about governance changes, or only Family Council?
- Should advisors be able to see application status in real-time?
- What happens if family receives multiple templates from different advisors?
- Should there be approval workflow if multiple Family Council members exist?

---

**Epic Status:** Ready for Review  
**Next Steps:** Product review ‚Üí Technical feasibility ‚Üí Grooming ‚Üí Design mockups ‚Üí Development planning  
**Estimated Effort:** 4-6 weeks (1 sprint for core application, 1 sprint for conflict resolution, 0.5-1 sprint for undo/notifications)