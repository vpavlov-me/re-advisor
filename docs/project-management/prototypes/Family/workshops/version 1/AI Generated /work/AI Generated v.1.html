<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Constitution Builder - AI Assessment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FB6428',
                        background: '#F6F8FA',
                        card: '#FFFFFF',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .fade-enter-from {
            opacity: 0;
            transform: translateY(10px);
        }
        .fade-leave-to {
            opacity: 0;
            transform: translateY(-10px);
        }

        .question-option {
            transition: all 0.2s ease;
        }
        .question-option:hover:not(.selected) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(251, 100, 40, 0.15);
        }
        .question-option.selected {
            border-color: #FB6428;
            background: rgba(251, 100, 40, 0.1);
        }

        .progress-bar {
            transition: width 0.5s ease;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse {
            animation: pulse 2s infinite;
        }

        .ai-avatar {
            background: linear-gradient(135deg, #FB6428 0%, rgba(251, 100, 40, 0.8) 100%);
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #FB6428;
            animation: typing 1.4s infinite;
            display: inline-block;
            margin: 0 2px;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        @keyframes checkmark {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .checkmark-animate {
            animation: checkmark 0.4s ease-out;
        }

        .section-badge {
            transition: all 0.3s ease;
        }

        .section-badge.completed {
            transform: scale(1.05);
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .slide-in {
            animation: slideInRight 0.5s ease-out;
        }
    </style>
</head>
<body class="bg-background">
    <div id="app"></div>

    <script type="module">
        const { createApp } = Vue;

        // 60 Questions Database organized in 12 sections of 5 questions each
        const questionsDatabase = [
            // Section 1: Communication Patterns (5 questions)
            {
                id: 1,
                sectionId: 1,
                sectionTitle: "Communication Patterns",
                sectionIcon: "üí¨",
                sectionDescription: "How your family talks, listens, and shares information",
                question: "How often does your family communicate about important decisions?",
                type: "scale",
                options: ["Rarely", "Occasionally", "Monthly", "Weekly", "Daily"]
            },
            {
                id: 2,
                sectionId: 1,
                sectionTitle: "Communication Patterns",
                sectionIcon: "üí¨",
                question: "Do you have regular family meetings or calls?",
                type: "yesno",
                options: ["Yes", "No", "Not Sure"]
            },
            {
                id: 3,
                sectionId: 1,
                sectionTitle: "Communication Patterns",
                sectionIcon: "üí¨",
                question: "How comfortable are family members sharing concerns openly?",
                type: "scale",
                options: ["Very Uncomfortable", "Uncomfortable", "Neutral", "Comfortable", "Very Comfortable"]
            },
            {
                id: 4,
                sectionId: 1,
                sectionTitle: "Communication Patterns",
                sectionIcon: "üí¨",
                question: "What communication channels does your family primarily use?",
                type: "choice",
                options: ["In-person meetings only", "Phone/video calls", "Messaging apps", "Multiple channels"]
            },
            {
                id: 5,
                sectionId: 1,
                sectionTitle: "Communication Patterns",
                sectionIcon: "üí¨",
                question: "How well do family members listen to each other?",
                type: "scale",
                options: ["Poorly", "Fair", "Good", "Very Good", "Excellent"]
            },

            // Section 2: Decision-Making Process (5 questions)
            {
                id: 6,
                sectionId: 2,
                sectionTitle: "Decision-Making Process",
                sectionIcon: "üéØ",
                sectionDescription: "How your family makes choices together",
                question: "Do you have formal rules for making family decisions?",
                type: "yesno",
                options: ["Yes", "No", "Not Sure"]
            },
            {
                id: 7,
                sectionId: 2,
                sectionTitle: "Decision-Making Process",
                sectionIcon: "üéØ",
                question: "Who typically makes major family decisions?",
                type: "choice",
                options: ["One senior member", "Parents/founders", "Family council", "Everyone equally"]
            },
            {
                id: 8,
                sectionId: 2,
                sectionTitle: "Decision-Making Process",
                sectionIcon: "üéØ",
                question: "How transparent is the decision-making process?",
                type: "scale",
                options: ["Not transparent", "Slightly transparent", "Moderately transparent", "Very transparent", "Completely transparent"]
            },
            {
                id: 9,
                sectionId: 2,
                sectionTitle: "Decision-Making Process",
                sectionIcon: "üéØ",
                question: "Are younger family members involved in important decisions?",
                type: "yesno",
                options: ["Yes", "No", "Sometimes"]
            },
            {
                id: 10,
                sectionId: 2,
                sectionTitle: "Decision-Making Process",
                sectionIcon: "üéØ",
                question: "How satisfied are you with the current decision-making process?",
                type: "scale",
                options: ["Very Dissatisfied", "Dissatisfied", "Neutral", "Satisfied", "Very Satisfied"]
            },

            // Section 3: Conflict Resolution (5 questions)
            {
                id: 11,
                sectionId: 3,
                sectionTitle: "Conflict Resolution",
                sectionIcon: "ü§ù",
                sectionDescription: "How your family handles disagreements and finds solutions",
                question: "Do you have a formal process for resolving family conflicts?",
                type: "yesno",
                options: ["Yes", "No", "Not Sure"]
            },
            {
                id: 12,
                sectionId: 3,
                sectionTitle: "Conflict Resolution",
                sectionIcon: "ü§ù",
                question: "How does your family typically handle disagreements?",
                type: "choice",
                options: ["Open discussion", "Mediation by senior member", "Avoidance / time healing", "No formal process"]
            },
            {
                id: 13,
                sectionId: 3,
                sectionTitle: "Conflict Resolution",
                sectionIcon: "ü§ù",
                question: "How comfortable are you addressing conflicts directly?",
                type: "scale",
                options: ["Very Uncomfortable", "Uncomfortable", "Neutral", "Comfortable", "Very Comfortable"]
            },
            {
                id: 14,
                sectionId: 3,
                sectionTitle: "Conflict Resolution",
                sectionIcon: "ü§ù",
                question: "Have you ever used external mediators or advisors?",
                type: "yesno",
                options: ["Yes", "No", "Considering it"]
            },
            {
                id: 15,
                sectionId: 3,
                sectionTitle: "Conflict Resolution",
                sectionIcon: "ü§ù",
                question: "How effectively does your family resolve conflicts?",
                type: "scale",
                options: ["Poorly", "Fair", "Good", "Very Good", "Excellent"]
            },

            // Section 4: Financial Transparency (5 questions)
            {
                id: 16,
                sectionId: 4,
                sectionTitle: "Financial Transparency",
                sectionIcon: "üí∞",
                sectionDescription: "How openly your family discusses money and wealth",
                question: "Do family members have access to financial information?",
                type: "yesno",
                options: ["Yes", "No", "Partial access"]
            },
            {
                id: 17,
                sectionId: 4,
                sectionTitle: "Financial Transparency",
                sectionIcon: "üí∞",
                question: "How often is financial information shared with the family?",
                type: "choice",
                options: ["Never", "Rarely", "Annually", "Quarterly", "Monthly"]
            },
            {
                id: 18,
                sectionId: 4,
                sectionTitle: "Financial Transparency",
                sectionIcon: "üí∞",
                question: "How transparent is your family about wealth and assets?",
                type: "scale",
                options: ["Not transparent", "Slightly transparent", "Moderately transparent", "Very transparent", "Completely transparent"]
            },
            {
                id: 19,
                sectionId: 4,
                sectionTitle: "Financial Transparency",
                sectionIcon: "üí∞",
                question: "Are investment decisions discussed openly with the family?",
                type: "yesno",
                options: ["Yes", "No", "Sometimes"]
            },
            {
                id: 20,
                sectionId: 4,
                sectionTitle: "Financial Transparency",
                sectionIcon: "üí∞",
                question: "How satisfied are you with the level of financial transparency?",
                type: "scale",
                options: ["Very Dissatisfied", "Dissatisfied", "Neutral", "Satisfied", "Very Satisfied"]
            },

            // Section 5: Roles & Responsibilities (5 questions)
            {
                id: 21,
                sectionId: 5,
                sectionTitle: "Roles & Responsibilities",
                sectionIcon: "üë•",
                sectionDescription: "Who does what in your family",
                question: "Are family roles and responsibilities clearly defined?",
                type: "yesno",
                options: ["Yes", "No", "Partially"]
            },
            {
                id: 22,
                sectionId: 5,
                sectionTitle: "Roles & Responsibilities",
                sectionIcon: "üë•",
                question: "Who manages the family's business and investments?",
                type: "choice",
                options: ["One senior member", "Professional advisors", "Family committee", "Shared responsibility"]
            },
            {
                id: 23,
                sectionId: 5,
                sectionTitle: "Roles & Responsibilities",
                sectionIcon: "üë•",
                question: "How clear are expectations for each family member?",
                type: "scale",
                options: ["Very Unclear", "Unclear", "Somewhat Clear", "Clear", "Very Clear"]
            },
            {
                id: 24,
                sectionId: 5,
                sectionTitle: "Roles & Responsibilities",
                sectionIcon: "üë•",
                question: "Do you have a family council or governance board?",
                type: "yesno",
                options: ["Yes", "No", "Planning to create"]
            },
            {
                id: 25,
                sectionId: 5,
                sectionTitle: "Roles & Responsibilities",
                sectionIcon: "üë•",
                question: "How satisfied are you with role clarity in your family?",
                type: "scale",
                options: ["Very Dissatisfied", "Dissatisfied", "Neutral", "Satisfied", "Very Satisfied"]
            },

            // Section 6: Trust & Accountability (5 questions)
            {
                id: 26,
                sectionId: 6,
                sectionTitle: "Trust & Accountability",
                sectionIcon: "üîí",
                sectionDescription: "Building confidence and responsibility within the family",
                question: "How much do you trust other family members with financial decisions?",
                type: "scale",
                options: ["No Trust", "Little Trust", "Moderate Trust", "High Trust", "Complete Trust"]
            },
            {
                id: 27,
                sectionId: 6,
                sectionTitle: "Trust & Accountability",
                sectionIcon: "üîí",
                question: "Are family members held accountable for their commitments?",
                type: "yesno",
                options: ["Yes", "No", "Sometimes"]
            },
            {
                id: 28,
                sectionId: 6,
                sectionTitle: "Trust & Accountability",
                sectionIcon: "üîí",
                question: "Do you have mechanisms to verify financial transactions?",
                type: "choice",
                options: ["No mechanisms", "Informal checks", "Annual audits", "Regular professional audits"]
            },
            {
                id: 29,
                sectionId: 6,
                sectionTitle: "Trust & Accountability",
                sectionIcon: "üîí",
                question: "How transparent are family members about their actions?",
                type: "scale",
                options: ["Not transparent", "Slightly transparent", "Moderately transparent", "Very transparent", "Completely transparent"]
            },
            {
                id: 30,
                sectionId: 6,
                sectionTitle: "Trust & Accountability",
                sectionIcon: "üîí",
                question: "Overall, how strong is trust within your family?",
                type: "scale",
                options: ["Very Weak", "Weak", "Moderate", "Strong", "Very Strong"]
            },

            // Section 7: Succession Readiness (5 questions)
            {
                id: 31,
                sectionId: 7,
                sectionTitle: "Succession Readiness",
                sectionIcon: "üîÑ",
                sectionDescription: "Preparing the next generation for leadership",
                question: "Do you have a formal succession plan?",
                type: "yesno",
                options: ["Yes", "No", "In development"]
            },
            {
                id: 32,
                sectionId: 7,
                sectionTitle: "Succession Readiness",
                sectionIcon: "üîÑ",
                question: "How prepared is the next generation to take on leadership?",
                type: "scale",
                options: ["Not Prepared", "Somewhat Prepared", "Moderately Prepared", "Well Prepared", "Fully Prepared"]
            },
            {
                id: 33,
                sectionId: 7,
                sectionTitle: "Succession Readiness",
                sectionIcon: "üîÑ",
                question: "Are younger family members receiving training and mentorship?",
                type: "yesno",
                options: ["Yes", "No", "Starting soon"]
            },
            {
                id: 34,
                sectionId: 7,
                sectionTitle: "Succession Readiness",
                sectionIcon: "üîÑ",
                question: "How clear is the timeline for leadership transition?",
                type: "choice",
                options: ["No timeline", "Vague timeline", "Rough timeline", "Clear timeline"]
            },
            {
                id: 35,
                sectionId: 7,
                sectionTitle: "Succession Readiness",
                sectionIcon: "üîÑ",
                question: "How confident are you in the succession plan?",
                type: "scale",
                options: ["Not Confident", "Slightly Confident", "Moderately Confident", "Confident", "Very Confident"]
            },

            // Section 8: Business Involvement (5 questions)
            {
                id: 36,
                sectionId: 8,
                sectionTitle: "Business Involvement",
                sectionIcon: "üíº",
                sectionDescription: "The relationship between family and business",
                question: "How involved is the family in business operations?",
                type: "choice",
                options: ["Not involved", "Oversight only", "Active management", "Full operational control"]
            },
            {
                id: 37,
                sectionId: 8,
                sectionTitle: "Business Involvement",
                sectionIcon: "üíº",
                question: "Are there clear rules about family employment in the business?",
                type: "yesno",
                options: ["Yes", "No", "Informal guidelines"]
            },
            {
                id: 38,
                sectionId: 8,
                sectionTitle: "Business Involvement",
                sectionIcon: "üíº",
                question: "How do family members gain business roles?",
                type: "choice",
                options: ["By birth right", "Based on qualifications", "Combination of both", "No clear process"]
            },
            {
                id: 39,
                sectionId: 8,
                sectionTitle: "Business Involvement",
                sectionIcon: "üíº",
                question: "How satisfied are you with business-family boundaries?",
                type: "scale",
                options: ["Very Dissatisfied", "Dissatisfied", "Neutral", "Satisfied", "Very Satisfied"]
            },
            {
                id: 40,
                sectionId: 8,
                sectionTitle: "Business Involvement",
                sectionIcon: "üíº",
                question: "Do you separate family and business decision-making?",
                type: "yesno",
                options: ["Yes", "No", "Partially"]
            },

            // Section 9: Education & Development (5 questions)
            {
                id: 41,
                sectionId: 9,
                sectionTitle: "Education & Development",
                sectionIcon: "üìö",
                sectionDescription: "Learning and growing as a family",
                question: "Does your family invest in financial education for members?",
                type: "yesno",
                options: ["Yes", "No", "Planning to"]
            },
            {
                id: 42,
                sectionId: 9,
                sectionTitle: "Education & Development",
                sectionIcon: "üìö",
                question: "What type of development programs does your family provide?",
                type: "choice",
                options: ["None", "Informal mentoring", "Formal training programs", "Comprehensive development plans"]
            },
            {
                id: 43,
                sectionId: 9,
                sectionTitle: "Education & Development",
                sectionIcon: "üìö",
                question: "How important is continuous learning in your family?",
                type: "scale",
                options: ["Not Important", "Slightly Important", "Moderately Important", "Important", "Very Important"]
            },
            {
                id: 44,
                sectionId: 9,
                sectionTitle: "Education & Development",
                sectionIcon: "üìö",
                question: "Do younger members have access to educational resources?",
                type: "yesno",
                options: ["Yes", "No", "Limited access"]
            },
            {
                id: 45,
                sectionId: 9,
                sectionTitle: "Education & Development",
                sectionIcon: "üìö",
                question: "How satisfied are you with family education initiatives?",
                type: "scale",
                options: ["Very Dissatisfied", "Dissatisfied", "Neutral", "Satisfied", "Very Satisfied"]
            },

            // Section 10: Philanthropy Alignment (5 questions)
            {
                id: 46,
                sectionId: 10,
                sectionTitle: "Philanthropy Alignment",
                sectionIcon: "‚ù§Ô∏è",
                sectionDescription: "Giving back and making an impact together",
                question: "Does your family engage in philanthropic activities?",
                type: "yesno",
                options: ["Yes", "No", "Considering it"]
            },
            {
                id: 47,
                sectionId: 10,
                sectionTitle: "Philanthropy Alignment",
                sectionIcon: "‚ù§Ô∏è",
                question: "How aligned are family members on philanthropic priorities?",
                type: "scale",
                options: ["Not Aligned", "Slightly Aligned", "Moderately Aligned", "Well Aligned", "Completely Aligned"]
            },
            {
                id: 48,
                sectionId: 10,
                sectionTitle: "Philanthropy Alignment",
                sectionIcon: "‚ù§Ô∏è",
                question: "What percentage of wealth does your family commit to charity?",
                type: "choice",
                options: ["None", "Less than 1%", "1-5%", "More than 5%"]
            },
            {
                id: 49,
                sectionId: 10,
                sectionTitle: "Philanthropy Alignment",
                sectionIcon: "‚ù§Ô∏è",
                question: "Do you have a formal philanthropy strategy?",
                type: "yesno",
                options: ["Yes", "No", "In development"]
            },
            {
                id: 50,
                sectionId: 10,
                sectionTitle: "Philanthropy Alignment",
                sectionIcon: "‚ù§Ô∏è",
                question: "How important is philanthropy to your family's identity?",
                type: "scale",
                options: ["Not Important", "Slightly Important", "Moderately Important", "Important", "Very Important"]
            },

            // Section 11: Wealth Philosophy (5 questions)
            {
                id: 51,
                sectionId: 11,
                sectionTitle: "Wealth Philosophy",
                sectionIcon: "üåü",
                sectionDescription: "Your family's beliefs and values about wealth",
                question: "Does your family have a clear wealth philosophy?",
                type: "yesno",
                options: ["Yes", "No", "Developing one"]
            },
            {
                id: 52,
                sectionId: 11,
                sectionTitle: "Wealth Philosophy",
                sectionIcon: "üåü",
                question: "What is your family's primary approach to wealth?",
                type: "choice",
                options: ["Preservation", "Growth", "Balanced approach", "No clear approach"]
            },
            {
                id: 53,
                sectionId: 11,
                sectionTitle: "Wealth Philosophy",
                sectionIcon: "üåü",
                question: "How aligned are family members on wealth values?",
                type: "scale",
                options: ["Not Aligned", "Slightly Aligned", "Moderately Aligned", "Well Aligned", "Completely Aligned"]
            },
            {
                id: 54,
                sectionId: 11,
                sectionTitle: "Wealth Philosophy",
                sectionIcon: "üåü",
                question: "Do you discuss wealth philosophy openly as a family?",
                type: "yesno",
                options: ["Yes", "No", "Rarely"]
            },
            {
                id: 55,
                sectionId: 11,
                sectionTitle: "Wealth Philosophy",
                sectionIcon: "üåü",
                question: "How important is wealth stewardship to future generations?",
                type: "scale",
                options: ["Not Important", "Slightly Important", "Moderately Important", "Important", "Very Important"]
            },

            // Section 12: Family Unity & Values (5 questions)
            {
                id: 56,
                sectionId: 12,
                sectionTitle: "Family Unity & Values",
                sectionIcon: "üè†",
                sectionDescription: "The bonds that hold your family together",
                question: "How strong is the sense of unity in your family?",
                type: "scale",
                options: ["Very Weak", "Weak", "Moderate", "Strong", "Very Strong"]
            },
            {
                id: 57,
                sectionId: 12,
                sectionTitle: "Family Unity & Values",
                sectionIcon: "üè†",
                question: "Have you defined core family values together?",
                type: "yesno",
                options: ["Yes", "No", "In progress"]
            },
            {
                id: 58,
                sectionId: 12,
                sectionTitle: "Family Unity & Values",
                sectionIcon: "üè†",
                question: "How often does your family gather for non-business purposes?",
                type: "choice",
                options: ["Rarely", "Annually", "Quarterly", "Monthly"]
            },
            {
                id: 59,
                sectionId: 12,
                sectionTitle: "Family Unity & Values",
                sectionIcon: "üè†",
                question: "How well do family members understand shared values?",
                type: "scale",
                options: ["Poorly", "Fair", "Good", "Very Good", "Excellent"]
            },
            {
                id: 60,
                sectionId: 12,
                sectionTitle: "Family Unity & Values",
                sectionIcon: "üè†",
                question: "Overall, how satisfied are you with family unity?",
                type: "scale",
                options: ["Very Dissatisfied", "Dissatisfied", "Neutral", "Satisfied", "Very Satisfied"]
            }
        ];

        // Test data for 4 family members
        const testFamilyResponses = [
            {
                name: "John Smith",
                role: "Client",
                completed: true,
                responses: Array.from({length: 60}, (_, i) => Math.floor(Math.random() * 5))
            },
            {
                name: "Mary Smith",
                role: "Client",
                completed: true,
                responses: Array.from({length: 60}, (_, i) => Math.floor(Math.random() * 5))
            },
            {
                name: "David Smith",
                role: "Client",
                completed: true,
                responses: Array.from({length: 60}, (_, i) => Math.floor(Math.random() * 5))
            },
            {
                name: "Sarah Smith",
                role: "Client",
                completed: false,
                responses: []
            }
        ];

        createApp({
            data() {
                return {
                    currentScreen: 'welcome', // 'welcome', 'assessment', 'section-complete', 'dashboard', 'analysis', 'report'
                    userName: 'Demo User',
                    userRole: 'Client',
                    currentQuestionIndex: 0,
                    responses: [],
                    currentPageAnswers: [], // Track answers for current page of 5 questions
                    questions: questionsDatabase,
                    familyResponses: testFamilyResponses,
                    showAIThinking: false,
                    constitutionDraft: null,
                    celebrationMode: false
                }
            },
            computed: {
                currentSection() {
                    return this.currentQuestion ? this.currentQuestion.sectionId : 1;
                },
                currentQuestion() {
                    return this.questions[this.currentQuestionIndex];
                },
                currentPageQuestions() {
                    const sectionStart = (this.currentSection - 1) * 5;
                    return this.questions.slice(sectionStart, sectionStart + 5);
                },
                currentQuestionInPage() {
                    return this.currentQuestionIndex % 5;
                },
                progress() {
                    return Math.round((this.currentQuestionIndex / this.questions.length) * 100);
                },
                sectionProgress() {
                    return Math.round(((this.currentSection - 1) / 12) * 100);
                },
                isSectionComplete() {
                    return this.currentQuestionIndex % 5 === 4;
                },
                completedSections() {
                    return Math.floor(this.responses.length / 5);
                },
                completedResponses() {
                    return this.familyResponses.filter(r => r.completed).length;
                },
                allCompleted() {
                    return this.familyResponses.every(r => r.completed);
                }
            },
            methods: {
                startAssessment() {
                    this.currentScreen = 'assessment';
                },
                answerQuestion(answerIndex) {
                    this.responses.push(answerIndex);
                    this.currentPageAnswers.push(answerIndex);

                    if (this.currentQuestionIndex < this.questions.length - 1) {
                        this.currentQuestionIndex++;

                        // Check if we completed a section (every 5 questions)
                        if (this.currentQuestionIndex % 5 === 0) {
                            this.showSectionComplete();
                        }
                    } else {
                        this.completeAssessment();
                    }
                },
                showSectionComplete() {
                    this.celebrationMode = true;
                    setTimeout(() => {
                        this.celebrationMode = false;
                        this.currentPageAnswers = [];
                    }, 2000);
                },
                completeAssessment() {
                    // Save current user's responses
                    const currentUser = {
                        name: this.userName,
                        role: this.userRole,
                        completed: true,
                        responses: this.responses
                    };

                    // Add to family responses if not exists
                    const existingIndex = this.familyResponses.findIndex(r => r.name === this.userName);
                    if (existingIndex >= 0) {
                        this.familyResponses[existingIndex] = currentUser;
                    } else {
                        this.familyResponses.push(currentUser);
                    }

                    this.currentScreen = 'dashboard';
                },
                analyzeResponses() {
                    this.showAIThinking = true;
                    this.currentScreen = 'analysis';

                    setTimeout(() => {
                        this.generateConstitutionDraft();
                        this.showAIThinking = false;
                        this.currentScreen = 'report';
                    }, 3000);
                },
                generateConstitutionDraft() {
                    // AI Analysis logic (simplified for demo)
                    const avgScores = Array(12).fill(0).map((_, sectionId) => {
                        const sectionQuestions = this.questions.filter(q => q.sectionId === sectionId + 1);
                        const allResponses = this.familyResponses
                            .filter(r => r.completed)
                            .flatMap(r => sectionQuestions.map((q, i) => r.responses[q.id - 1] || 0));

                        return allResponses.reduce((a, b) => a + b, 0) / allResponses.length;
                    });

                    this.constitutionDraft = {
                        overallScore: (avgScores.reduce((a, b) => a + b, 0) / avgScores.length).toFixed(1),
                        categoryScores: avgScores,
                        sections: this.generateSections(avgScores),
                        recommendations: this.generateRecommendations(avgScores)
                    };
                },
                generateSections(avgScores) {
                    return [
                        {
                            title: "Preamble",
                            content: `We, the ${this.userName.split(' ')[1] || 'Family'}, united by shared values and commitment to our collective future, establish this Constitution to guide our family governance for generations to come.`
                        },
                        {
                            title: "Family Values & Mission",
                            content: avgScores[0] > 3
                                ? "Strong communication, transparency, and mutual respect form the foundation of our family values."
                                : "Our family is committed to improving communication and fostering open dialogue among all members."
                        },
                        {
                            title: "Governance Structure",
                            content: avgScores[1] > 3
                                ? "Family council meets quarterly to make major decisions through structured voting processes."
                                : "We recognize the need to formalize our governance structure with clear decision-making protocols."
                        },
                        {
                            title: "Wealth Management",
                            content: avgScores[3] > 3
                                ? "Professional advisors manage our portfolio with regular reporting to all family members."
                                : "We are developing transparent wealth management practices with defined reporting mechanisms."
                        },
                        {
                            title: "Education & Development",
                            content: avgScores[8] > 3
                                ? "Mandatory financial literacy programs for next generation, with ongoing professional development."
                                : "We commit to establishing comprehensive education programs for all family members."
                        },
                        {
                            title: "Decision Making",
                            content: avgScores[1] > 3
                                ? "Major decisions require 75% vote approval from family council members."
                                : "We will implement formal voting rules and decision-making thresholds."
                        },
                        {
                            title: "Succession Planning",
                            content: avgScores[6] > 3
                                ? "Mentorship program pairs next generation with current leaders for 5-year transition."
                                : "We recognize the critical need for formal succession planning and leadership development."
                        },
                        {
                            title: "Family Philanthropy",
                            content: avgScores[9] > 3
                                ? "5% annual giving commitment focused on education and community development."
                                : "We are exploring philanthropic opportunities aligned with our family values."
                        },
                        {
                            title: "Conflict Resolution",
                            content: avgScores[2] > 3
                                ? "3-step mediation process: direct dialogue, family council mediation, external arbitration."
                                : "We will establish formal conflict resolution procedures with clear escalation paths."
                        },
                        {
                            title: "Voting Rules",
                            content: "One vote per adult family member. Major decisions require 75% approval. Amendments require unanimous consent."
                        },
                        {
                            title: "Amendment Process",
                            content: "Constitution amendments require: (1) written proposal, (2) 30-day review period, (3) family meeting discussion, (4) unanimous vote approval."
                        }
                    ];
                },
                generateRecommendations(avgScores) {
                    const categoryNames = [
                        "Communication Patterns",
                        "Decision-Making Process",
                        "Conflict Resolution",
                        "Financial Transparency",
                        "Roles & Responsibilities",
                        "Trust & Accountability",
                        "Succession Readiness",
                        "Business Involvement",
                        "Education & Development",
                        "Philanthropy Alignment",
                        "Wealth Philosophy",
                        "Family Unity & Values"
                    ];

                    const weakAreas = avgScores
                        .map((score, i) => ({ score, category: categoryNames[i], index: i }))
                        .filter(item => item.score < 3)
                        .sort((a, b) => a.score - b.score)
                        .slice(0, 3);

                    return weakAreas.length > 0
                        ? weakAreas.map(area => ({
                            category: area.category,
                            priority: area.score < 2 ? "High Priority" : "Medium Priority",
                            recommendation: this.getRecommendation(area.index)
                        }))
                        : [{ category: "Overall", priority: "Low Priority", recommendation: "Your family shows strong governance practices across all dimensions. Focus on continuous improvement and regular reviews." }];
                },
                getRecommendation(categoryIndex) {
                    const recommendations = [
                        "Establish regular family meetings (monthly or quarterly) with structured agendas.",
                        "Create formal decision-making framework with clear voting thresholds and approval processes.",
                        "Implement 3-step conflict resolution process: direct dialogue ‚Üí family mediation ‚Üí external arbitration.",
                        "Schedule quarterly financial transparency sessions with professional advisors present.",
                        "Document roles and responsibilities in family governance charter with annual reviews.",
                        "Conduct regular trust-building exercises and transparent accountability mechanisms.",
                        "Develop 5-year succession plan with mentorship programs for next generation.",
                        "Define clear policies for family business involvement based on qualifications and merit.",
                        "Launch family education program with financial literacy and leadership development modules.",
                        "Align on shared philanthropic vision through family retreats and structured discussions.",
                        "Co-create wealth philosophy statement through facilitated family workshops.",
                        "Organize annual family retreats focused on values alignment and relationship building."
                    ];
                    return recommendations[categoryIndex];
                }
            },
            template: `
                <div class="min-h-screen py-8">
                    <div class="max-w-4xl mx-auto px-4">

                        <!-- Welcome Screen -->
                        <transition name="fade" mode="out-in">
                            <div v-if="currentScreen === 'welcome'" class="space-y-6">
                                <div class="bg-gradient-to-br from-primary to-orange-600 rounded-2xl shadow-xl p-8 md:p-12 text-white text-center">
                                    <div class="w-24 h-24 rounded-full bg-white flex items-center justify-center mx-auto mb-6">
                                        <span class="text-5xl">üìú</span>
                                    </div>
                                    <h1 class="text-3xl md:text-4xl font-bold mb-4">Build Your Family Constitution</h1>
                                    <p class="text-xl mb-8 opacity-90">20 minutes ‚Ä¢ 60 questions ‚Ä¢ AI-powered insights</p>
                                </div>

                                <div class="bg-card rounded-xl shadow-sm p-8 space-y-6">
                                    <div>
                                        <h2 class="text-2xl font-bold text-gray-900 mb-4">What You'll Get</h2>
                                        <div class="space-y-4">
                                            <div class="flex gap-4 items-start">
                                                <div class="w-12 h-12 rounded-lg bg-green-100 flex items-center justify-center flex-shrink-0">
                                                    <span class="text-2xl">‚ú®</span>
                                                </div>
                                                <div>
                                                    <div class="font-semibold text-gray-900 mb-1">Your Custom Family Constitution</div>
                                                    <div class="text-gray-600 text-sm">A professional document tailored to your family's unique governance needs</div>
                                                </div>
                                            </div>
                                            <div class="flex gap-4 items-start">
                                                <div class="w-12 h-12 rounded-lg bg-blue-100 flex items-center justify-center flex-shrink-0">
                                                    <span class="text-2xl">üéØ</span>
                                                </div>
                                                <div>
                                                    <div class="font-semibold text-gray-900 mb-1">Clear Priorities & Recommendations</div>
                                                    <div class="text-gray-600 text-sm">AI identifies what matters most and suggests next steps</div>
                                                </div>
                                            </div>
                                            <div class="flex gap-4 items-start">
                                                <div class="w-12 h-12 rounded-lg bg-purple-100 flex items-center justify-center flex-shrink-0">
                                                    <span class="text-2xl">ü§ù</span>
                                                </div>
                                                <div>
                                                    <div class="font-semibold text-gray-900 mb-1">Family Alignment Insights</div>
                                                    <div class="text-gray-600 text-sm">Understand where your family agrees and where conversations are needed</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="border-t pt-6">
                                        <h3 class="font-semibold text-gray-900 mb-3">How It Works</h3>
                                        <div class="grid grid-cols-3 gap-4 text-center">
                                            <div>
                                                <div class="text-3xl mb-2">üìù</div>
                                                <div class="text-sm font-medium text-gray-900">12 Sections</div>
                                                <div class="text-xs text-gray-600">5 questions each</div>
                                            </div>
                                            <div>
                                                <div class="text-3xl mb-2">‚è±Ô∏è</div>
                                                <div class="text-sm font-medium text-gray-900">~20 Minutes</div>
                                                <div class="text-xs text-gray-600">At your own pace</div>
                                            </div>
                                            <div>
                                                <div class="text-3xl mb-2">ü§ñ</div>
                                                <div class="text-sm font-medium text-gray-900">AI Analysis</div>
                                                <div class="text-xs text-gray-600">Instant results</div>
                                            </div>
                                        </div>
                                    </div>

                                    <button
                                        @click="startAssessment"
                                        class="w-full py-4 bg-primary rounded-xl font-semibold text-white text-lg hover:bg-orange-600 transition-all shadow-lg hover:shadow-xl"
                                    >
                                        Start Building Your Constitution ‚Üí
                                    </button>

                                    <p class="text-center text-sm text-gray-500">
                                        Simple questions. Powerful results. No governance experience needed.
                                    </p>
                                </div>
                            </div>

                            <!-- Assessment Screen - Page by Page -->
                            <div v-else-if="currentScreen === 'assessment'" class="space-y-6">
                                <!-- Progress Header -->
                                <div class="bg-card rounded-xl shadow-sm p-6">
                                    <div class="flex items-center gap-4 mb-4">
                                        <div class="w-12 h-12 rounded-full flex items-center justify-center text-2xl" :class="celebrationMode ? 'ai-avatar checkmark-animate' : 'bg-gray-100'">
                                            {{ celebrationMode ? 'üéâ' : currentQuestion.sectionIcon }}
                                        </div>
                                        <div class="flex-1">
                                            <div class="font-semibold text-gray-900">Section {{ currentSection }} of 12</div>
                                            <div class="text-sm text-gray-600">{{ currentQuestion.sectionTitle }}</div>
                                            <div v-if="currentQuestion.sectionDescription && currentQuestionInPage === 0" class="text-xs text-gray-500 mt-1">
                                                {{ currentQuestion.sectionDescription }}
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-2xl font-bold text-primary">{{ currentSection }}/12</div>
                                            <div class="text-xs text-gray-500">sections</div>
                                        </div>
                                    </div>

                                    <!-- Section Progress -->
                                    <div class="space-y-2">
                                        <div class="flex justify-between text-xs text-gray-500">
                                            <span>Section Progress</span>
                                            <span>{{ currentQuestionInPage + 1 }}/5 questions</span>
                                        </div>
                                        <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                                            <div class="progress-bar h-full bg-green-500" :style="{width: ((currentQuestionInPage + 1) / 5 * 100) + '%'}"></div>
                                        </div>
                                    </div>

                                    <!-- Overall Progress -->
                                    <div class="mt-3 pt-3 border-t">
                                        <div class="flex justify-between text-xs text-gray-500 mb-1">
                                            <span>Overall Progress</span>
                                            <span>{{ responses.length }}/60 answered</span>
                                        </div>
                                        <div class="h-1.5 bg-gray-100 rounded-full overflow-hidden">
                                            <div class="progress-bar h-full bg-primary" :style="{width: progress + '%'}"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Celebration for Section Complete -->
                                <div v-if="celebrationMode" class="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl shadow-sm p-8 text-center slide-in">
                                    <div class="text-6xl mb-4">üéâ</div>
                                    <h3 class="text-2xl font-bold text-gray-900 mb-2">Section Complete!</h3>
                                    <p class="text-gray-600">{{ currentQuestion.sectionTitle }} finished. Moving to next section...</p>
                                </div>

                                <!-- Question Card -->
                                <div v-if="!celebrationMode" class="bg-card rounded-xl shadow-sm p-8">
                                    <div class="mb-6">
                                        <div class="text-sm font-medium text-primary mb-2">Question {{ currentQuestionInPage + 1 }} of 5</div>
                                        <h2 class="text-2xl font-semibold text-gray-900">{{ currentQuestion.question }}</h2>
                                    </div>

                                    <!-- Scale options (1-5) -->
                                    <div v-if="currentQuestion.type === 'scale'" class="grid grid-cols-5 gap-3">
                                        <button
                                            v-for="(option, index) in currentQuestion.options"
                                            :key="index"
                                            @click="answerQuestion(index)"
                                            class="question-option border-2 border-gray-200 rounded-xl p-4 text-center hover:shadow-lg transition-all"
                                        >
                                            <div class="text-3xl font-bold text-primary mb-2">{{ index + 1 }}</div>
                                            <div class="text-xs text-gray-600 leading-tight">{{ option }}</div>
                                        </button>
                                    </div>

                                    <!-- Yes/No options -->
                                    <div v-else-if="currentQuestion.type === 'yesno'" class="grid grid-cols-3 gap-4">
                                        <button
                                            v-for="(option, index) in currentQuestion.options"
                                            :key="index"
                                            @click="answerQuestion(index)"
                                            class="question-option border-2 border-gray-200 rounded-xl p-6 text-center hover:shadow-lg transition-all"
                                        >
                                            <div class="text-lg font-semibold text-gray-900">{{ option }}</div>
                                        </button>
                                    </div>

                                    <!-- Choice options -->
                                    <div v-else-if="currentQuestion.type === 'choice'" class="space-y-3">
                                        <button
                                            v-for="(option, index) in currentQuestion.options"
                                            :key="index"
                                            @click="answerQuestion(index)"
                                            class="question-option w-full border-2 border-gray-200 rounded-xl p-5 text-left hover:shadow-lg transition-all"
                                        >
                                            <div class="text-base font-medium text-gray-900">{{ option }}</div>
                                        </button>
                                    </div>
                                </div>

                                <!-- Mini sections overview -->
                                <div v-if="!celebrationMode" class="bg-card rounded-xl shadow-sm p-6">
                                    <div class="text-sm font-medium text-gray-700 mb-3">Your Progress Through the Assessment</div>
                                    <div class="grid grid-cols-6 md:grid-cols-12 gap-2">
                                        <div
                                            v-for="section in 12"
                                            :key="section"
                                            class="section-badge aspect-square rounded-lg flex items-center justify-center text-lg transition-all"
                                            :class="section < currentSection ? 'bg-green-100 text-green-600 completed' :
                                                    section === currentSection ? 'bg-primary text-white ring-2 ring-primary ring-offset-2' :
                                                    'bg-gray-100 text-gray-400'"
                                        >
                                            {{ section < currentSection ? '‚úì' : section }}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Dashboard Screen -->
                            <div v-else-if="currentScreen === 'dashboard'" class="space-y-6">
                                <div class="bg-card rounded-xl shadow-sm p-8">
                                    <div class="text-center mb-8">
                                        <div class="text-6xl mb-4">üéä</div>
                                        <h2 class="text-3xl font-bold text-gray-900 mb-2">You Did It!</h2>
                                        <p class="text-gray-600">Your responses have been saved. Here's your family's progress:</p>
                                    </div>

                                    <!-- Completion Status -->
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                                        <div
                                            v-for="(member, index) in familyResponses"
                                            :key="index"
                                            class="border-2 rounded-xl p-5 transition-all"
                                            :class="member.completed ? 'border-green-500 bg-green-50' : 'border-gray-200'"
                                        >
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <div class="font-semibold text-gray-900">{{ member.name }}</div>
                                                    <div class="text-sm text-gray-600">{{ member.role }}</div>
                                                </div>
                                                <div v-if="member.completed" class="text-green-600">
                                                    <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 20 20">
                                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                                    </svg>
                                                </div>
                                                <div v-else class="text-gray-300">
                                                    <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 20 20">
                                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                                    </svg>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Progress summary -->
                                    <div class="bg-gradient-to-br from-blue-50 to-purple-50 border-2 border-blue-200 rounded-xl p-8 text-center mb-6">
                                        <div class="text-5xl font-bold text-primary mb-2">{{ completedResponses }} / {{ familyResponses.length }}</div>
                                        <div class="text-lg text-gray-700 font-medium">Family Members Completed</div>
                                        <div v-if="allCompleted" class="mt-4 text-green-600 font-semibold">
                                            üéâ Everyone's done! Ready to generate your constitution.
                                        </div>
                                    </div>

                                    <!-- Action button -->
                                    <button
                                        @click="analyzeResponses"
                                        class="w-full py-5 rounded-xl font-semibold text-white text-lg transition-all shadow-lg hover:shadow-xl"
                                        :class="allCompleted ? 'bg-primary hover:bg-orange-600' : 'bg-primary hover:bg-orange-600'"
                                    >
                                        {{ allCompleted ? 'üöÄ Generate Your Family Constitution' : 'üìä Analyze Available Responses' }}
                                    </button>
                                    <p v-if="!allCompleted" class="text-center text-sm text-gray-500 mt-3">
                                        You can generate a constitution now, or wait for others to complete their assessment.
                                    </p>
                                </div>
                            </div>

                            <!-- Analysis Screen -->
                            <div v-else-if="currentScreen === 'analysis'" class="space-y-6">
                                <div class="bg-card rounded-xl shadow-sm p-12 text-center">
                                    <div class="w-24 h-24 rounded-full ai-avatar flex items-center justify-center mx-auto mb-6 pulse">
                                        <span class="text-white text-5xl">ü§ñ</span>
                                    </div>
                                    <h2 class="text-3xl font-bold text-gray-900 mb-4">AI is Crafting Your Constitution...</h2>
                                    <div class="typing-indicator flex justify-center mb-8">
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                    </div>
                                    <div class="space-y-3 text-gray-600 max-w-md mx-auto text-lg">
                                        <p>‚úì Analyzing {{ completedResponses }} family member responses</p>
                                        <p>‚úì Evaluating 12 governance dimensions</p>
                                        <p>‚úì Identifying alignment and opportunities</p>
                                        <p>‚úì Generating your custom constitution...</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Report Screen -->
                            <div v-else-if="currentScreen === 'report' && constitutionDraft" class="space-y-6">
                                <!-- Overall Score -->
                                <div class="bg-gradient-to-br from-primary to-orange-600 rounded-2xl shadow-xl p-8 text-center text-white">
                                    <div class="text-6xl mb-4">üìú</div>
                                    <h2 class="text-3xl font-bold mb-4">Your Family Constitution is Ready!</h2>
                                    <div class="inline-block bg-white/20 backdrop-blur rounded-xl px-8 py-4">
                                        <div class="text-5xl font-bold mb-1">{{ constitutionDraft.overallScore }}/5</div>
                                        <div class="text-sm opacity-90">Governance Readiness Score</div>
                                    </div>
                                </div>

                                <!-- Constitution Sections -->
                                <div class="bg-card rounded-xl shadow-sm p-8">
                                    <div class="flex items-center gap-3 mb-6">
                                        <span class="text-3xl">üìÑ</span>
                                        <h3 class="text-2xl font-bold text-gray-900">Your Family Constitution</h3>
                                    </div>
                                    <div class="space-y-6">
                                        <div
                                            v-for="(section, index) in constitutionDraft.sections"
                                            :key="index"
                                            class="border-l-4 border-primary pl-6 py-3 hover:bg-gray-50 transition-all rounded-r"
                                        >
                                            <h4 class="text-lg font-bold text-gray-900 mb-2">
                                                Article {{ index + 1 }}: {{ section.title }}
                                            </h4>
                                            <p class="text-gray-700 leading-relaxed">{{ section.content }}</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Recommendations -->
                                <div class="bg-card rounded-xl shadow-sm p-8">
                                    <div class="flex items-center gap-3 mb-6">
                                        <span class="text-3xl">üí°</span>
                                        <h3 class="text-2xl font-bold text-gray-900">Priority Recommendations</h3>
                                    </div>
                                    <p class="text-gray-600 mb-6">Based on your family's responses, here are the most important areas to focus on:</p>
                                    <div class="space-y-4">
                                        <div
                                            v-for="(rec, index) in constitutionDraft.recommendations"
                                            :key="index"
                                            class="border-2 rounded-xl p-6 transition-all hover:shadow-md"
                                            :class="rec.priority === 'High Priority' ? 'border-red-200 bg-red-50' : 'border-yellow-200 bg-yellow-50'"
                                        >
                                            <div class="flex items-start gap-4">
                                                <div class="text-3xl">{{ rec.priority === 'High Priority' ? 'üî¥' : 'üü°' }}</div>
                                                <div class="flex-1">
                                                    <div class="flex items-center gap-3 mb-2">
                                                        <div class="font-bold text-gray-900 text-lg">{{ rec.category }}</div>
                                                        <div class="text-sm px-3 py-1 rounded-full font-medium"
                                                             :class="rec.priority === 'High Priority' ? 'bg-red-200 text-red-800' : 'bg-yellow-200 text-yellow-800'">
                                                            {{ rec.priority }}
                                                        </div>
                                                    </div>
                                                    <div class="text-gray-700 leading-relaxed">{{ rec.recommendation }}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- What's Next -->
                                <div class="bg-gradient-to-br from-green-50 to-blue-50 rounded-xl border-2 border-green-200 p-8">
                                    <h3 class="text-xl font-bold text-gray-900 mb-4">üéØ What's Next?</h3>
                                    <div class="space-y-3 text-gray-700">
                                        <p>‚úì <strong>Download</strong> your constitution and share it with your family</p>
                                        <p>‚úì <strong>Schedule</strong> a family meeting to discuss the recommendations</p>
                                        <p>‚úì <strong>Work with</strong> your advisor to implement priority actions</p>
                                        <p>‚úì <strong>Review</strong> your constitution annually and update as needed</p>
                                    </div>
                                </div>

                                <!-- Action buttons -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <button
                                        @click="currentScreen = 'welcome'; currentQuestionIndex = 0; responses = [];"
                                        class="py-4 border-2 border-gray-300 rounded-xl font-semibold text-gray-700 hover:bg-gray-50 transition-all"
                                    >
                                        ‚Üê Start New Assessment
                                    </button>
                                    <button
                                        class="py-4 bg-primary rounded-xl font-semibold text-white hover:bg-orange-600 transition-all shadow-lg hover:shadow-xl"
                                    >
                                        üì• Download Constitution (PDF)
                                    </button>
                                </div>
                            </div>
                        </transition>

                    </div>
                </div>
            `
        }).mount('#app');
    </script>
</body>
</html>
