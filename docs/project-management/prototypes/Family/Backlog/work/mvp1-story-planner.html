<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MVP1 Story Planner - Family Governance Platform</title>
    <style>
        /* Corporate Design System */
        :root {
            --primary-color: #1a4d8f;
            --primary-dark: #0f3666;
            --primary-light: #2b6bb8;
            --secondary-color: #5a7fa3;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --light-gray: #f8f9fa;
            --medium-gray: #e9ecef;
            --dark-gray: #495057;
            --border-color: #dee2e6;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 8px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 16px rgba(0,0,0,0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--light-gray);
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-color) 100%);
            color: white;
            padding: 24px 32px;
            box-shadow: var(--shadow-md);
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin: 0;
        }

        .header-subtitle {
            font-size: 13px;
            opacity: 0.9;
            margin-top: 4px;
        }

        /* Main Container */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 32px;
        }

        /* MVP1 Summary Panel */
        .mvp1-summary {
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 24px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .summary-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .summary-subtext {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Layout */
        .planner-layout {
            display: grid;
            grid-template-columns: 1fr 450px;
            gap: 24px;
            min-height: 800px;
        }

        /* Story Pool */
        .story-pool {
            background: white;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            padding: 24px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border-color);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Filters */
        .filters {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid var(--border-color);
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .filter-btn:hover {
            border-color: var(--primary-color);
            background: var(--light-gray);
        }

        .filter-btn.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .filter-btn.priority-critical {
            border-color: #dc3545;
        }

        .filter-btn.priority-critical.active {
            background: #dc3545;
            border-color: #dc3545;
        }

        .filter-btn.priority-high {
            border-color: #ffc107;
        }

        .filter-btn.priority-high.active {
            background: #ffc107;
            border-color: #ffc107;
            color: #333;
        }

        /* Story Cards */
        .story-cards {
            display: grid;
            gap: 12px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .story-card {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            cursor: move;
            transition: all 0.2s ease;
            position: relative;
        }

        .story-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .story-card.dragging {
            opacity: 0.5;
        }

        .story-card.in-mvp1 {
            opacity: 0.3;
            pointer-events: none;
            background: var(--light-gray);
        }

        .story-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .story-id {
            font-size: 12px;
            font-weight: 700;
            color: var(--primary-color);
            background: var(--light-gray);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .story-badges {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .story-sp {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            background: var(--medium-gray);
            padding: 3px 8px;
            border-radius: 3px;
        }

        .story-readiness {
            font-size: 11px;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 3px;
        }

        .readiness-critical { background: #ffebee; color: #c62828; }
        .readiness-low { background: #fff3e0; color: #e65100; }
        .readiness-medium { background: #fff9c4; color: #f57f17; }
        .readiness-high { background: #e8f5e9; color: #2e7d32; }

        .story-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .story-description {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .story-block {
            font-size: 11px;
            color: var(--text-secondary);
            font-style: italic;
        }

        .priority-indicator {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            border-radius: 8px 0 0 8px;
        }

        .priority-critical .priority-indicator { background: #dc3545; }
        .priority-high .priority-indicator { background: #ffc107; }
        .priority-medium .priority-indicator { background: #17a2b8; }
        .priority-low .priority-indicator { background: #6c757d; }

        .add-btn {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 8px;
            width: 100%;
        }

        .add-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .add-btn:disabled {
            background: var(--medium-gray);
            color: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
        }

        /* MVP1 Builder */
        .mvp1-builder {
            background: white;
            border-radius: 8px;
            box-shadow: var(--shadow-md);
            padding: 24px;
            position: sticky;
            top: 32px;
            height: fit-content;
            max-height: calc(100vh - 64px);
            display: flex;
            flex-direction: column;
        }

        .builder-header {
            margin-bottom: 20px;
        }

        .builder-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 12px;
        }

        .builder-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 16px;
            background: var(--light-gray);
            border-radius: 6px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            margin-top: 4px;
        }

        /* Drop Zone */
        .drop-zone {
            flex: 1;
            border: 3px dashed var(--border-color);
            border-radius: 8px;
            padding: 20px;
            min-height: 300px;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
            transition: all 0.2s ease;
        }

        .drop-zone.drag-over {
            border-color: var(--primary-color);
            background: rgba(26, 77, 143, 0.05);
        }

        .drop-zone-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-secondary);
            text-align: center;
        }

        .drop-zone-empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .mvp1-story {
            background: var(--light-gray);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }

        .mvp1-story:hover {
            background: var(--medium-gray);
        }

        .mvp1-story-info {
            flex: 1;
        }

        .mvp1-story-id {
            font-size: 11px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .mvp1-story-title {
            font-size: 13px;
            font-weight: 600;
            margin-top: 2px;
        }

        .mvp1-story-meta {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-top: 4px;
        }

        .remove-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .remove-btn:hover {
            background: #c82333;
        }

        /* Action Buttons */
        .builder-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--medium-gray);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--dark-gray);
            color: white;
        }

        .btn-full {
            grid-column: 1 / -1;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .planner-layout {
                grid-template-columns: 1fr;
            }

            .mvp1-builder {
                position: static;
                max-height: none;
            }
        }

        /* Scrollbar Styling */
        .story-cards::-webkit-scrollbar,
        .drop-zone::-webkit-scrollbar {
            width: 8px;
        }

        .story-cards::-webkit-scrollbar-track,
        .drop-zone::-webkit-scrollbar-track {
            background: var(--light-gray);
            border-radius: 4px;
        }

        .story-cards::-webkit-scrollbar-thumb,
        .drop-zone::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        .story-cards::-webkit-scrollbar-thumb:hover,
        .drop-zone::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div>
                <h1>MVP1 Story Planner</h1>
                <div class="header-subtitle">Build your MVP1 by selecting user stories - Target: 145 SP (~5-6 months)</div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- MVP1 Summary -->
        <div class="mvp1-summary">
            <div class="summary-item">
                <div class="summary-label">Total Stories Available</div>
                <div class="summary-value" id="totalStoriesCount">0</div>
                <div class="summary-subtext">Across 15 blocks</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">Critical Priority</div>
                <div class="summary-value" id="criticalCount">0</div>
                <div class="summary-subtext">Must-have stories</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">High Priority</div>
                <div class="summary-value" id="highCount">0</div>
                <div class="summary-subtext">Important stories</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">Available SP</div>
                <div class="summary-value" id="availableSP">0</div>
                <div class="summary-subtext">Total story points</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">MVP1 Target</div>
                <div class="summary-value">145 SP</div>
                <div class="summary-subtext">5-6 months</div>
            </div>
        </div>

        <!-- Planner Layout -->
        <div class="planner-layout">
            <!-- Story Pool -->
            <div class="story-pool">
                <div class="section-header">
                    <h2 class="section-title">Available User Stories</h2>
                </div>

                <!-- Filters -->
                <div class="filters">
                    <button class="filter-btn active" data-filter="all" onclick="filterStories('all')">
                        All Stories
                    </button>
                    <button class="filter-btn priority-critical" data-filter="critical" onclick="filterStories('critical')">
                        ðŸ”´ Critical
                    </button>
                    <button class="filter-btn priority-high" data-filter="high" onclick="filterStories('high')">
                        ðŸŸ¡ High
                    </button>
                    <button class="filter-btn" data-filter="medium" onclick="filterStories('medium')">
                        ðŸŸ  Medium
                    </button>
                    <button class="filter-btn" data-filter="low" onclick="filterStories('low')">
                        ðŸŸ¢ Low
                    </button>
                </div>

                <!-- Story Cards -->
                <div class="story-cards" id="storyCards"></div>
            </div>

            <!-- MVP1 Builder -->
            <div class="mvp1-builder">
                <div class="builder-header">
                    <div class="builder-title">MVP1 Build</div>
                    <div class="builder-stats">
                        <div class="stat-item">
                            <div class="stat-label">Stories</div>
                            <div class="stat-value" id="mvp1Count">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Story Points</div>
                            <div class="stat-value" id="mvp1SP">0</div>
                        </div>
                        <div class="stat-item" style="grid-column: 1 / -1;">
                            <div class="stat-label">Estimated Duration</div>
                            <div class="stat-value" id="mvp1Duration" style="font-size: 18px;">0 sprints</div>
                        </div>
                    </div>
                </div>

                <!-- Drop Zone -->
                <div class="drop-zone" id="dropZone">
                    <div class="drop-zone-empty">
                        <div class="drop-zone-empty-icon">ðŸ“‹</div>
                        <div>
                            <strong>Drag stories here</strong><br>
                            <span style="font-size: 12px;">Or click "Add to MVP1" button on story cards</span>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="builder-actions">
                    <button class="btn btn-secondary" onclick="clearMVP1()">
                        Clear All
                    </button>
                    <button class="btn btn-primary" onclick="exportMVP1()">
                        Export
                    </button>
                    <button class="btn btn-primary btn-full" onclick="saveMVP1()">
                        Save MVP1 Plan
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data from Blueprint analysis (same as main prototype)
        const blocksData = [
            {
                number: 1,
                name: "Family Graph, Identity & Access",
                stories: [
                    {
                        id: "1.1",
                        title: "Role Assignment with Term Dates",
                        description: "Assign committee roles with start/end terms so access changes automatically",
                        readiness: 0,
                        sp: 13,
                        priority: "critical",
                        blockName: "Family Graph, Identity & Access"
                    },
                    {
                        id: "1.2",
                        title: "Guest Access for External Advisors",
                        description: "Guest access to only the Investment space invited to",
                        readiness: 33,
                        sp: 13,
                        priority: "high",
                        blockName: "Family Graph, Identity & Access"
                    },
                    {
                        id: "1.3",
                        title: "Conflict of Interest Detection",
                        description: "Conflicts of interest flagged before votes",
                        readiness: 0,
                        sp: 8,
                        priority: "critical",
                        blockName: "Family Graph, Identity & Access"
                    }
                ]
            },
            {
                number: 2,
                name: "Living Constitution & Policy Board",
                stories: [
                    {
                        id: "2.1",
                        title: "Convert PDF Constitution to Living Policy",
                        description: "Convert PDF constitution into living policy with clauses, owners, and review cadence",
                        readiness: 12,
                        sp: 16,
                        priority: "critical",
                        blockName: "Living Constitution & Policy Board"
                    },
                    {
                        id: "2.2",
                        title: "Show How Clause is Lived",
                        description: "See how this clause is lived with linked practices and tasks",
                        readiness: 30,
                        sp: 10,
                        priority: "high",
                        blockName: "Living Constitution & Policy Board"
                    },
                    {
                        id: "2.3",
                        title: "Lock Policy During Review",
                        description: "Lock a policy during legal review",
                        readiness: 0,
                        sp: 10,
                        priority: "critical",
                        blockName: "Living Constitution & Policy Board"
                    }
                ]
            },
            {
                number: 3,
                name: "Meetings, Decisions & Async Gov",
                stories: [
                    {
                        id: "3.1",
                        title: "Consent Agenda with Quorum",
                        description: "Run consent agenda and record votes with quorum check",
                        readiness: 52,
                        sp: 10,
                        priority: "high",
                        blockName: "Meetings, Decisions & Async Gov"
                    },
                    {
                        id: "3.2",
                        title: "E-Vote Between Meetings",
                        description: "Request e-vote between meetings with expiry",
                        readiness: 50,
                        sp: 8,
                        priority: "medium",
                        blockName: "Meetings, Decisions & Async Gov"
                    },
                    {
                        id: "3.3",
                        title: "Decision Lineage",
                        description: "See decision lineage showing the policy and evidence used",
                        readiness: 57,
                        sp: 5,
                        priority: "low",
                        blockName: "Meetings, Decisions & Async Gov"
                    }
                ]
            },
            {
                number: 4,
                name: "Tasking, Projects & Accountability",
                stories: [
                    {
                        id: "4.1",
                        title: "Member Accountability Dashboard",
                        description: "See attendance, prep, and action completion by member",
                        readiness: 38,
                        sp: 8,
                        priority: "high",
                        blockName: "Tasking, Projects & Accountability"
                    },
                    {
                        id: "4.2",
                        title: "Pre-Read Compliance",
                        description: "Auto-prompts to upload pre-reads and mark readiness",
                        readiness: 29,
                        sp: 10,
                        priority: "medium",
                        blockName: "Tasking, Projects & Accountability"
                    },
                    {
                        id: "4.3",
                        title: "Export Overdue Tasks",
                        description: "Export overdue tasks by body and owner",
                        readiness: 30,
                        sp: 5,
                        priority: "low",
                        blockName: "Tasking, Projects & Accountability"
                    }
                ]
            },
            {
                number: 5,
                name: "Engagement Analytics & Signals",
                stories: [
                    {
                        id: "5.1",
                        title: "Contributors & Quiet Cohort",
                        description: "View top contributors list and quiet cohort radar",
                        readiness: 12,
                        sp: 13,
                        priority: "critical",
                        blockName: "Engagement Analytics & Signals"
                    },
                    {
                        id: "5.2",
                        title: "Branch Engagement Alerts",
                        description: "Alert if branch engagement drops >30% QoQ",
                        readiness: 0,
                        sp: 13,
                        priority: "high",
                        blockName: "Engagement Analytics & Signals"
                    },
                    {
                        id: "5.3",
                        title: "Participation-Outcome Correlation",
                        description: "Correlate participation with project outcomes",
                        readiness: 0,
                        sp: 13,
                        priority: "medium",
                        blockName: "Engagement Analytics & Signals"
                    }
                ]
            },
            {
                number: 14,
                name: "Knowledge Base & Multi-Space",
                stories: [
                    {
                        id: "14.1",
                        title: "Multi-Space Announcements",
                        description: "Publish one announcement to Board and Family Council simultaneously",
                        readiness: 25,
                        sp: 10,
                        priority: "high",
                        blockName: "Knowledge Base & Multi-Space"
                    },
                    {
                        id: "14.2",
                        title: "Threaded Q&A",
                        description: "Run Q&A threads instead of top-down memos",
                        readiness: 0,
                        sp: 10,
                        priority: "medium",
                        blockName: "Knowledge Base & Multi-Space"
                    },
                    {
                        id: "14.3",
                        title: "Scope-Based Content Filtering",
                        description: "See only items shared to my space",
                        readiness: 20,
                        sp: 8,
                        priority: "high",
                        blockName: "Knowledge Base & Multi-Space"
                    }
                ]
            }
        ];

        // Flatten all stories
        let allStories = [];
        blocksData.forEach(block => {
            allStories = allStories.concat(block.stories);
        });

        // State
        let mvp1Stories = [];
        let currentFilter = 'all';

        // Initialize
        function init() {
            updateSummaryStats();
            renderStories();
            setupDragAndDrop();
        }

        // Update summary statistics
        function updateSummaryStats() {
            const criticalStories = allStories.filter(s => s.priority === 'critical');
            const highStories = allStories.filter(s => s.priority === 'high');
            const totalSP = allStories.reduce((sum, s) => sum + s.sp, 0);

            document.getElementById('totalStoriesCount').textContent = allStories.length;
            document.getElementById('criticalCount').textContent = criticalStories.length;
            document.getElementById('highCount').textContent = highStories.length;
            document.getElementById('availableSP').textContent = totalSP;
        }

        // Filter stories
        function filterStories(priority) {
            currentFilter = priority;

            // Update filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-filter="${priority}"]`).classList.add('active');

            renderStories();
        }

        // Render story cards
        function renderStories() {
            const container = document.getElementById('storyCards');
            container.innerHTML = '';

            const filtered = currentFilter === 'all'
                ? allStories
                : allStories.filter(s => s.priority === currentFilter);

            filtered.forEach(story => {
                const card = createStoryCard(story);
                container.appendChild(card);
            });
        }

        // Create story card element
        function createStoryCard(story) {
            const card = document.createElement('div');
            card.className = `story-card priority-${story.priority}`;
            card.draggable = true;
            card.dataset.storyId = story.id;

            const isInMVP1 = mvp1Stories.some(s => s.id === story.id);
            if (isInMVP1) {
                card.classList.add('in-mvp1');
            }

            const readinessClass = story.readiness < 15 ? 'readiness-critical' :
                                  story.readiness < 30 ? 'readiness-low' :
                                  story.readiness < 70 ? 'readiness-medium' : 'readiness-high';

            card.innerHTML = `
                <div class="priority-indicator"></div>
                <div class="story-card-header">
                    <div class="story-id">${story.id}</div>
                    <div class="story-badges">
                        <div class="story-sp">${story.sp} SP</div>
                        <div class="story-readiness ${readinessClass}">${story.readiness}%</div>
                    </div>
                </div>
                <div class="story-title">${story.title}</div>
                <div class="story-description">${story.description}</div>
                <div class="story-block">Block: ${story.blockName}</div>
                <button class="add-btn" onclick="addToMVP1('${story.id}')" ${isInMVP1 ? 'disabled' : ''}>
                    ${isInMVP1 ? 'âœ“ Added to MVP1' : '+ Add to MVP1'}
                </button>
            `;

            // Drag events
            card.addEventListener('dragstart', handleDragStart);
            card.addEventListener('dragend', handleDragEnd);

            return card;
        }

        // Drag and drop handlers
        function setupDragAndDrop() {
            const dropZone = document.getElementById('dropZone');

            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });

            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('drag-over');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');

                const storyId = e.dataTransfer.getData('text/plain');
                addToMVP1(storyId);
            });
        }

        function handleDragStart(e) {
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', e.target.dataset.storyId);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        // Add story to MVP1
        function addToMVP1(storyId) {
            const story = allStories.find(s => s.id === storyId);
            if (!story || mvp1Stories.some(s => s.id === storyId)) return;

            mvp1Stories.push(story);
            updateMVP1Display();
            renderStories(); // Re-render to show disabled state
        }

        // Remove story from MVP1
        function removeFromMVP1(storyId) {
            mvp1Stories = mvp1Stories.filter(s => s.id !== storyId);
            updateMVP1Display();
            renderStories(); // Re-render to show enabled state
        }

        // Update MVP1 display
        function updateMVP1Display() {
            const dropZone = document.getElementById('dropZone');

            if (mvp1Stories.length === 0) {
                dropZone.innerHTML = `
                    <div class="drop-zone-empty">
                        <div class="drop-zone-empty-icon">ðŸ“‹</div>
                        <div>
                            <strong>Drag stories here</strong><br>
                            <span style="font-size: 12px;">Or click "Add to MVP1" button on story cards</span>
                        </div>
                    </div>
                `;
            } else {
                dropZone.innerHTML = mvp1Stories.map(story => `
                    <div class="mvp1-story">
                        <div class="mvp1-story-info">
                            <div class="mvp1-story-id">${story.id}</div>
                            <div class="mvp1-story-title">${story.title}</div>
                            <div class="mvp1-story-meta">
                                <span class="story-sp">${story.sp} SP</span>
                                <span class="story-readiness ${
                                    story.readiness < 15 ? 'readiness-critical' :
                                    story.readiness < 30 ? 'readiness-low' :
                                    story.readiness < 70 ? 'readiness-medium' : 'readiness-high'
                                }">${story.readiness}%</span>
                            </div>
                        </div>
                        <button class="remove-btn" onclick="removeFromMVP1('${story.id}')">Remove</button>
                    </div>
                `).join('');
            }

            // Update stats
            const totalSP = mvp1Stories.reduce((sum, s) => sum + s.sp, 0);
            const sprints = Math.ceil(totalSP / 12); // Assuming 12 SP per sprint
            const months = Math.ceil(sprints / 2); // 2 sprints per month

            document.getElementById('mvp1Count').textContent = mvp1Stories.length;
            document.getElementById('mvp1SP').textContent = totalSP;
            document.getElementById('mvp1Duration').textContent = `${sprints} sprints (~${months} months)`;
        }

        // Clear MVP1
        function clearMVP1() {
            if (mvp1Stories.length === 0) return;

            if (confirm('Are you sure you want to clear all stories from MVP1?')) {
                mvp1Stories = [];
                updateMVP1Display();
                renderStories();
            }
        }

        // Export MVP1
        function exportMVP1() {
            if (mvp1Stories.length === 0) {
                alert('No stories in MVP1 to export.');
                return;
            }

            const totalSP = mvp1Stories.reduce((sum, s) => sum + s.sp, 0);
            const sprints = Math.ceil(totalSP / 12);
            const months = Math.ceil(sprints / 2);

            let markdown = `# MVP1 User Stories Plan\n\n`;
            markdown += `**Generated:** ${new Date().toLocaleDateString()}\n\n`;
            markdown += `## Summary\n\n`;
            markdown += `- **Total Stories:** ${mvp1Stories.length}\n`;
            markdown += `- **Total Story Points:** ${totalSP} SP\n`;
            markdown += `- **Estimated Duration:** ${sprints} sprints (~${months} months)\n`;
            markdown += `- **Target:** 145 SP (5-6 months)\n\n`;

            markdown += `## Stories by Priority\n\n`;

            ['critical', 'high', 'medium', 'low'].forEach(priority => {
                const stories = mvp1Stories.filter(s => s.priority === priority);
                if (stories.length === 0) return;

                const priorityLabel = {
                    'critical': 'ðŸ”´ Critical',
                    'high': 'ðŸŸ¡ High',
                    'medium': 'ðŸŸ  Medium',
                    'low': 'ðŸŸ¢ Low'
                }[priority];

                markdown += `### ${priorityLabel}\n\n`;
                stories.forEach(story => {
                    markdown += `#### ${story.id}: ${story.title}\n\n`;
                    markdown += `- **Block:** ${story.blockName}\n`;
                    markdown += `- **Story Points:** ${story.sp} SP\n`;
                    markdown += `- **Readiness:** ${story.readiness}%\n`;
                    markdown += `- **Description:** ${story.description}\n\n`;
                });
            });

            // Download as file
            const blob = new Blob([markdown], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'mvp1-stories-plan.md';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Save MVP1
        function saveMVP1() {
            if (mvp1Stories.length === 0) {
                alert('No stories in MVP1 to save.');
                return;
            }

            const totalSP = mvp1Stories.reduce((sum, s) => sum + s.sp, 0);

            // Save to localStorage
            const mvp1Plan = {
                date: new Date().toISOString(),
                stories: mvp1Stories,
                totalSP: totalSP,
                storyCount: mvp1Stories.length
            };

            localStorage.setItem('mvp1_plan', JSON.stringify(mvp1Plan));
            alert(`MVP1 plan saved successfully!\n\n${mvp1Stories.length} stories, ${totalSP} SP`);
        }

        // Load saved MVP1 on init
        function loadSavedMVP1() {
            const saved = localStorage.getItem('mvp1_plan');
            if (saved) {
                try {
                    const plan = JSON.parse(saved);
                    mvp1Stories = plan.stories;
                    updateMVP1Display();
                    renderStories();
                } catch (e) {
                    console.error('Failed to load saved MVP1:', e);
                }
            }
        }

        // Initialize on load
        window.addEventListener('load', () => {
            init();
            loadSavedMVP1();
        });
    </script>
</body>
</html>
