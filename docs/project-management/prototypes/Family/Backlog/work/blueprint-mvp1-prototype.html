<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blueprint vs MVP1 Analysis - Interactive Dashboard</title>
    <style>
        /* Corporate Design System */
        :root {
            --primary-color: #1a4d8f;
            --primary-dark: #0f3666;
            --primary-light: #2b6bb8;
            --secondary-color: #5a7fa3;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --light-gray: #f8f9fa;
            --medium-gray: #e9ecef;
            --dark-gray: #495057;
            --border-color: #dee2e6;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 8px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 16px rgba(0,0,0,0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--light-gray);
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-color) 100%);
            color: white;
            padding: 24px 32px;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin: 0;
        }

        .header-meta {
            display: flex;
            gap: 24px;
            font-size: 13px;
            opacity: 0.9;
        }

        .header-meta-item {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .header-meta-label {
            font-size: 11px;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .header-meta-value {
            font-size: 18px;
            font-weight: 600;
            margin-top: 2px;
        }

        /* Navigation */
        .nav {
            background: white;
            border-bottom: 2px solid var(--border-color);
            position: sticky;
            top: 80px;
            z-index: 99;
            box-shadow: var(--shadow-sm);
        }

        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 32px;
            display: flex;
            gap: 8px;
        }

        .nav-btn {
            padding: 14px 20px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .nav-btn:hover {
            color: var(--primary-color);
            background: var(--light-gray);
        }

        .nav-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background: var(--light-gray);
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px;
        }

        /* View Sections */
        .view {
            display: none;
        }

        .view.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard Section */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 32px;
        }

        .metric-card {
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            border-left: 4px solid var(--primary-color);
        }

        .metric-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--primary-color);
            line-height: 1;
        }

        .metric-subtext {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        /* Heatmap */
        .heatmap-container {
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border-color);
        }

        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
        }

        .heatmap-cell {
            background: var(--light-gray);
            padding: 16px;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .heatmap-cell:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }

        .heatmap-cell-number {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .heatmap-cell-name {
            font-size: 11px;
            color: var(--text-primary);
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            height: 32px;
        }

        .heatmap-cell-readiness {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .heatmap-cell-sp {
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* Readiness color coding */
        .readiness-critical { background-color: #ffebee; color: #c62828; }
        .readiness-low { background-color: #fff3e0; color: #e65100; }
        .readiness-medium { background-color: #fff9c4; color: #f57f17; }
        .readiness-high { background-color: #e8f5e9; color: #2e7d32; }

        /* Priority Badge */
        .priority-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .priority-critical { background: #ffebee; color: #c62828; }
        .priority-high { background: #fff3e0; color: #e65100; }
        .priority-medium { background: #e3f2fd; color: #1565c0; }
        .priority-low { background: #f3e5f5; color: #6a1b9a; }

        /* Blocks Table */
        .blocks-container {
            background: white;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .filters {
            padding: 20px 24px;
            background: var(--light-gray);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .filter-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .filter-select {
            padding: 8px 32px 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: white;
            font-size: 13px;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23495057' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .search-box {
            flex: 1;
            min-width: 250px;
        }

        .search-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 13px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .blocks-table {
            width: 100%;
            border-collapse: collapse;
        }

        .blocks-table thead {
            background: var(--light-gray);
        }

        .blocks-table th {
            padding: 12px 16px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--border-color);
            cursor: pointer;
            user-select: none;
        }

        .blocks-table th:hover {
            background: var(--medium-gray);
        }

        .blocks-table th.sortable::after {
            content: ' â†•';
            opacity: 0.3;
        }

        .blocks-table th.sort-asc::after {
            content: ' â†‘';
            opacity: 1;
        }

        .blocks-table th.sort-desc::after {
            content: ' â†“';
            opacity: 1;
        }

        .blocks-table tbody tr {
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.15s ease;
        }

        .blocks-table tbody tr:hover {
            background: var(--light-gray);
        }

        .blocks-table td {
            padding: 16px;
            font-size: 13px;
        }

        .block-name {
            font-weight: 600;
            color: var(--primary-color);
        }

        .block-number {
            color: var(--text-secondary);
            font-size: 12px;
        }

        .progress-bar-container {
            width: 100%;
            height: 20px;
            background: var(--medium-gray);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-light), var(--primary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
            font-weight: 600;
            transition: width 0.3s ease;
        }

        /* Block Details Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.2s ease;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            max-width: 1000px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 24px 32px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--light-gray);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }

        .modal-close:hover {
            background: var(--medium-gray);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 32px;
        }

        .block-info-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        .block-info-item {
            padding: 16px;
            background: var(--light-gray);
            border-radius: 6px;
        }

        .block-info-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .block-info-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .user-stories {
            margin-top: 24px;
        }

        .user-story {
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-bottom: 16px;
            background: white;
        }

        .user-story-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .user-story-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
        }

        .user-story-meta {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .user-story-sp {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .user-story-readiness {
            font-size: 14px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 4px;
        }

        .user-story-description {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .user-story-criteria {
            margin-top: 12px;
        }

        .criteria-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .criteria-list {
            list-style: none;
            padding: 0;
        }

        .criteria-item {
            padding: 8px 12px;
            background: var(--light-gray);
            border-radius: 4px;
            margin-bottom: 6px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .criteria-status {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 3px;
            font-weight: 600;
        }

        .status-complete { background: #d4edda; color: #155724; }
        .status-partial { background: #fff3cd; color: #856404; }
        .status-missing { background: #f8d7da; color: #721c24; }

        /* Dependency Graph */
        .dependency-graph {
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
        }

        .graph-container {
            width: 100%;
            height: 600px;
            background: var(--light-gray);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: auto;
        }

        .graph-svg {
            width: 100%;
            height: 100%;
        }

        .graph-node {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .graph-node:hover {
            filter: brightness(1.1);
        }

        .graph-node rect {
            fill: var(--primary-color);
            stroke: var(--primary-dark);
            stroke-width: 2;
            rx: 6;
        }

        .graph-node.priority-critical rect {
            fill: #dc3545;
        }

        .graph-node.priority-high rect {
            fill: #ffc107;
        }

        .graph-node.priority-medium rect {
            fill: #17a2b8;
        }

        .graph-node.priority-low rect {
            fill: #6c757d;
        }

        .graph-node text {
            fill: white;
            font-size: 11px;
            font-weight: 600;
            text-anchor: middle;
        }

        .graph-link {
            stroke: var(--secondary-color);
            stroke-width: 2;
            fill: none;
            opacity: 0.4;
        }

        .graph-link.active {
            opacity: 1;
            stroke-width: 3;
        }

        .graph-legend {
            padding: 16px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-top: 16px;
        }

        .legend-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .legend-items {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .heatmap-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 16px;
                align-items: flex-start;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .heatmap-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .block-info-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .blocks-table {
                font-size: 12px;
            }

            .blocks-table td,
            .blocks-table th {
                padding: 12px 8px;
            }
        }

        /* Loading State */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .spinner {
            border: 3px solid var(--light-gray);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div>
                <h1>Blueprint vs MVP1 Analysis</h1>
                <div style="font-size: 13px; opacity: 0.9; margin-top: 4px;">
                    Family Governance Platform - Implementation Readiness Dashboard
                </div>
            </div>
            <div class="header-meta">
                <div class="header-meta-item">
                    <div class="header-meta-label">Overall Readiness</div>
                    <div class="header-meta-value" id="overallReadiness">18%</div>
                </div>
                <div class="header-meta-item">
                    <div class="header-meta-label">Total Story Points</div>
                    <div class="header-meta-value" id="totalSP">450 SP</div>
                </div>
                <div class="header-meta-item">
                    <div class="header-meta-label">Timeline</div>
                    <div class="header-meta-value">17-19 mo</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav">
        <div class="nav-content">
            <button class="nav-btn active" onclick="showView('dashboard')">Dashboard</button>
            <button class="nav-btn" onclick="showView('blocks')">All Blocks</button>
            <button class="nav-btn" onclick="showView('dependencies')">Dependencies</button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Dashboard View -->
        <div id="dashboard" class="view active">
            <!-- Metrics Cards -->
            <div class="dashboard-grid">
                <div class="metric-card">
                    <div class="metric-label">Overall Readiness</div>
                    <div class="metric-value">18%</div>
                    <div class="metric-subtext">Early stage implementation</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Total Story Points</div>
                    <div class="metric-value">450</div>
                    <div class="metric-subtext">~34-38 sprints (17-19 months)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Blocks Complete</div>
                    <div class="metric-value">0 / 15</div>
                    <div class="metric-subtext">None above 70% ready</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">MVP1 Target</div>
                    <div class="metric-value">145 SP</div>
                    <div class="metric-subtext">10-12 sprints (~5-6 months)</div>
                </div>
            </div>

            <!-- Readiness Heatmap -->
            <div class="heatmap-container">
                <h2 class="section-title">Readiness Heatmap - 15 Feature Blocks</h2>
                <div class="heatmap-grid" id="heatmapGrid"></div>
            </div>
        </div>

        <!-- Blocks Table View -->
        <div id="blocks" class="view">
            <div class="blocks-container">
                <div class="filters">
                    <div class="filter-group">
                        <span class="filter-label">Priority:</span>
                        <select class="filter-select" id="priorityFilter" onchange="filterBlocks()">
                            <option value="all">All Priorities</option>
                            <option value="critical">ðŸ”´ Critical</option>
                            <option value="high">ðŸŸ¡ High</option>
                            <option value="medium">ðŸŸ  Medium</option>
                            <option value="low">ðŸŸ¢ Low</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <span class="filter-label">Readiness:</span>
                        <select class="filter-select" id="readinessFilter" onchange="filterBlocks()">
                            <option value="all">All Readiness Levels</option>
                            <option value="0-30">0-30% (Critical)</option>
                            <option value="30-70">30-70% (Partial)</option>
                            <option value="70-100">70-100% (Good)</option>
                        </select>
                    </div>
                    <div class="search-box">
                        <input type="text" class="search-input" id="searchInput" placeholder="Search blocks by name or keywords..." oninput="filterBlocks()">
                    </div>
                </div>
                <table class="blocks-table">
                    <thead>
                        <tr>
                            <th class="sortable" onclick="sortTable('number')">#</th>
                            <th class="sortable" onclick="sortTable('name')">Block Name</th>
                            <th class="sortable" onclick="sortTable('readiness')">Readiness</th>
                            <th class="sortable" onclick="sortTable('sp')">Story Points</th>
                            <th class="sortable" onclick="sortTable('priority')">Priority</th>
                            <th>Stories</th>
                        </tr>
                    </thead>
                    <tbody id="blocksTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Dependencies View -->
        <div id="dependencies" class="view">
            <div class="dependency-graph">
                <h2 class="section-title">Block Dependencies & Critical Path</h2>
                <div class="graph-container" id="graphContainer">
                    <svg class="graph-svg" id="dependencyGraph"></svg>
                </div>
                <div class="graph-legend">
                    <div class="legend-title">Priority Legend</div>
                    <div class="legend-items">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #dc3545;"></div>
                            <span>ðŸ”´ Critical (MVP1 Blocker)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #ffc107;"></div>
                            <span>ðŸŸ¡ High (MVP1 Enhanced)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #17a2b8;"></div>
                            <span>ðŸŸ  Medium (Post-MVP1)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #6c757d;"></div>
                            <span>ðŸŸ¢ Low (Future)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Block Details Modal -->
    <div id="blockModal" class="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle"></h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        // Data Structure
        const blocksData = [
            {
                number: 1,
                name: "Family Graph, Identity & Access",
                readiness: 11,
                storyPoints: 34,
                priority: "critical",
                sprints: "3-4",
                keyBlockers: "Role effective dates, workspace model, conflict declarations",
                stories: [
                    {
                        id: "1.1",
                        title: "Role Assignment with Term Dates",
                        description: "Assign committee roles with start/end terms so access changes automatically",
                        readiness: 0,
                        sp: 13,
                        priority: "critical",
                        acceptanceCriteria: [
                            { text: "Role effective dates", status: "missing", readiness: 0 },
                            { text: "Automatic permission update", status: "missing", readiness: 0 },
                            { text: "Audit log entry", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "1.2",
                        title: "Guest Access for External Advisors",
                        description: "Guest access to only the Investment space invited to",
                        readiness: 33,
                        sp: 13,
                        priority: "high",
                        acceptanceCriteria: [
                            { text: "Invite-only SSO/OIDC", status: "partial", readiness: 70 },
                            { text: "Scope-limited roles", status: "partial", readiness: 30 },
                            { text: "View/download controls", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "1.3",
                        title: "Conflict of Interest Detection",
                        description: "Conflicts of interest flagged before votes",
                        readiness: 0,
                        sp: 8,
                        priority: "critical",
                        acceptanceCriteria: [
                            { text: "Conflict declarations linked to members", status: "missing", readiness: 0 },
                            { text: "Blocking warning pre-vote", status: "missing", readiness: 0 }
                        ]
                    }
                ]
            },
            {
                number: 2,
                name: "Living Constitution & Policy Board",
                readiness: 14,
                storyPoints: 36,
                priority: "critical",
                sprints: "3-4",
                keyBlockers: "Versioning system, lock mechanism, clause linkage",
                stories: [
                    {
                        id: "2.1",
                        title: "Convert PDF Constitution to Living Policy",
                        description: "Convert PDF constitution into living policy with clauses, owners, and review cadence",
                        readiness: 12,
                        sp: 16,
                        priority: "critical",
                        acceptanceCriteria: [
                            { text: "Clause IDs", status: "partial", readiness: 50 },
                            { text: "Owner fields", status: "missing", readiness: 0 },
                            { text: "Next review date", status: "missing", readiness: 0 },
                            { text: "Change-log diff", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "2.2",
                        title: "Show How Clause is Lived",
                        description: "See how this clause is lived with linked practices and tasks",
                        readiness: 30,
                        sp: 10,
                        priority: "high",
                        acceptanceCriteria: [
                            { text: "Clause â†’ practice links", status: "missing", readiness: 0 },
                            { text: "Task rollups", status: "partial", readiness: 40 },
                            { text: "Status badges", status: "partial", readiness: 50 }
                        ]
                    },
                    {
                        id: "2.3",
                        title: "Lock Policy During Review",
                        description: "Lock a policy during legal review",
                        readiness: 0,
                        sp: 10,
                        priority: "critical",
                        acceptanceCriteria: [
                            { text: "Lock state", status: "missing", readiness: 0 },
                            { text: "Reviewer field", status: "missing", readiness: 0 },
                            { text: "Reason", status: "missing", readiness: 0 },
                            { text: "Unlock workflow", status: "missing", readiness: 0 }
                        ]
                    }
                ]
            },
            {
                number: 3,
                name: "Meetings, Decisions & Async Gov",
                readiness: 53,
                storyPoints: 23,
                priority: "high",
                sprints: "2",
                keyBlockers: "Quorum enforcement, auto-close, immutable minutes",
                stories: [
                    {
                        id: "3.1",
                        title: "Consent Agenda with Quorum",
                        description: "Run consent agenda and record votes with quorum check",
                        readiness: 52,
                        sp: 10,
                        priority: "high",
                        acceptanceCriteria: [
                            { text: "Quorum calc", status: "partial", readiness: 60 },
                            { text: "Member eligibility", status: "partial", readiness: 45 },
                            { text: "Vote types", status: "complete", readiness: 75 },
                            { text: "Immutable minute entry", status: "partial", readiness: 30 }
                        ]
                    },
                    {
                        id: "3.2",
                        title: "E-Vote Between Meetings",
                        description: "Request e-vote between meetings with expiry",
                        readiness: 50,
                        sp: 8,
                        priority: "medium",
                        acceptanceCriteria: [
                            { text: "Vote window", status: "complete", readiness: 75 },
                            { text: "Reminders", status: "partial", readiness: 50 },
                            { text: "Auto-close", status: "missing", readiness: 0 },
                            { text: "Outcome stored", status: "complete", readiness: 75 }
                        ]
                    },
                    {
                        id: "3.3",
                        title: "Decision Lineage",
                        description: "See decision lineage showing the policy and evidence used",
                        readiness: 57,
                        sp: 5,
                        priority: "low",
                        acceptanceCriteria: [
                            { text: "Decision â†’ policy chain", status: "partial", readiness: 60 },
                            { text: "Documents chain", status: "partial", readiness: 40 },
                            { text: "Timestamped trails", status: "complete", readiness: 70 }
                        ]
                    }
                ]
            },
            {
                number: 4,
                name: "Tasking, Projects & Accountability",
                readiness: 32,
                storyPoints: 23,
                priority: "high",
                sprints: "2",
                keyBlockers: "Document tracking, nudge system, export",
                stories: [
                    {
                        id: "4.1",
                        title: "Member Accountability Dashboard",
                        description: "See attendance, prep, and action completion by member",
                        readiness: 38,
                        sp: 8,
                        priority: "high",
                        acceptanceCriteria: [
                            { text: "Attendance log", status: "complete", readiness: 75 },
                            { text: "Pre-read open rate", status: "missing", readiness: 0 },
                            { text: "Task completion rate", status: "partial", readiness: 40 }
                        ]
                    },
                    {
                        id: "4.2",
                        title: "Pre-Read Compliance",
                        description: "Auto-prompts to upload pre-reads and mark readiness",
                        readiness: 29,
                        sp: 10,
                        priority: "medium",
                        acceptanceCriteria: [
                            { text: "Pre-read checklist", status: "partial", readiness: 40 },
                            { text: "Due dates", status: "complete", readiness: 75 },
                            { text: "Nudge system", status: "missing", readiness: 0 },
                            { text: "Non-compliance flag", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "4.3",
                        title: "Export Overdue Tasks",
                        description: "Export overdue tasks by body and owner",
                        readiness: 30,
                        sp: 5,
                        priority: "low",
                        acceptanceCriteria: [
                            { text: "Filter by committee/owner", status: "partial", readiness: 30 },
                            { text: "CSV export", status: "missing", readiness: 0 },
                            { text: "API", status: "partial", readiness: 60 }
                        ]
                    }
                ]
            },
            {
                number: 5,
                name: "Engagement Analytics & Signals",
                readiness: 4,
                storyPoints: 39,
                priority: "critical",
                sprints: "3-4",
                keyBlockers: "Analytics service, alert engine, branch model",
                stories: [
                    {
                        id: "5.1",
                        title: "Contributors & Quiet Cohort",
                        description: "View top contributors list and quiet cohort radar",
                        readiness: 12,
                        sp: 13,
                        priority: "critical",
                        acceptanceCriteria: [
                            { text: "Ranked lists", status: "missing", readiness: 0 },
                            { text: "Trend sparkline", status: "missing", readiness: 0 },
                            { text: "Threshold alerts", status: "partial", readiness: 35 }
                        ]
                    },
                    {
                        id: "5.2",
                        title: "Branch Engagement Alerts",
                        description: "Alert if branch engagement drops >30% QoQ",
                        readiness: 0,
                        sp: 13,
                        priority: "high",
                        acceptanceCriteria: [
                            { text: "Branch segmentation", status: "missing", readiness: 0 },
                            { text: "Baseline", status: "missing", readiness: 0 },
                            { text: "Alert rules", status: "missing", readiness: 0 },
                            { text: "Explanation drill-down", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "5.3",
                        title: "Participation-Outcome Correlation",
                        description: "Correlate participation with project outcomes",
                        readiness: 0,
                        sp: 13,
                        priority: "medium",
                        acceptanceCriteria: [
                            { text: "Join analytics to KPIs", status: "missing", readiness: 0 },
                            { text: "Correlation view", status: "missing", readiness: 0 }
                        ]
                    }
                ]
            },
            {
                number: 6,
                name: "Difficult-Conversation Studio",
                readiness: 11,
                storyPoints: 23,
                priority: "medium",
                sprints: "2",
                keyBlockers: "Template system, anonymous intake",
                stories: [
                    {
                        id: "6.1",
                        title: "Setup Difficult Conversation",
                        description: "Set norms, attendees, neutral venue, purpose, and pre-work",
                        readiness: 0,
                        sp: 10,
                        priority: "medium",
                        acceptanceCriteria: [
                            { text: "Norms template", status: "missing", readiness: 0 },
                            { text: "Inclusion checklist", status: "missing", readiness: 0 },
                            { text: "Private prep space", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "6.2",
                        title: "Anonymous Pre-Session Questions",
                        description: "Submit questions anonymously pre-session",
                        readiness: 0,
                        sp: 8,
                        priority: "medium",
                        acceptanceCriteria: [
                            { text: "Anonymous intake", status: "missing", readiness: 0 },
                            { text: "Moderator view only", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "6.3",
                        title: "Log Outcomes to Registries",
                        description: "Log outcomes and follow-ups into decision/task registries",
                        readiness: 33,
                        sp: 5,
                        priority: "low",
                        acceptanceCriteria: [
                            { text: "Outcome summary", status: "missing", readiness: 0 },
                            { text: "Task creation", status: "partial", readiness: 60 },
                            { text: "Review date", status: "partial", readiness: 40 }
                        ]
                    }
                ]
            },
            {
                number: 7,
                name: "Question-Based Facilitation",
                readiness: 7,
                storyPoints: 26,
                priority: "low",
                sprints: "2",
                keyBlockers: "Prompt library, interactive timer, AI",
                stories: [
                    {
                        id: "7.1",
                        title: "Question Burst Session",
                        description: "Run 5-minute Question Burst with scribe and no answers rule",
                        readiness: 22,
                        sp: 10,
                        priority: "low",
                        acceptanceCriteria: [
                            { text: "Timer", status: "partial", readiness: 40 },
                            { text: "Question-only input", status: "missing", readiness: 0 },
                            { text: "Transcript", status: "partial", readiness: 50 },
                            { text: "Debrief template", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "7.2",
                        title: "Outcome Frame Prompts",
                        description: "Flip problem frame to outcome frame prompts",
                        readiness: 0,
                        sp: 8,
                        priority: "low",
                        acceptanceCriteria: [
                            { text: "One-click prompt swap", status: "missing", readiness: 0 },
                            { text: "Sample questions", status: "missing", readiness: 0 },
                            { text: "Summary capture", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "7.3",
                        title: "Question Scoring",
                        description: "Score questions for power and bias before meeting",
                        readiness: 0,
                        sp: 8,
                        priority: "low",
                        acceptanceCriteria: [
                            { text: "Question scoring rubric", status: "missing", readiness: 0 },
                            { text: "Suggestions", status: "missing", readiness: 0 }
                        ]
                    }
                ]
            },
            {
                number: 8,
                name: "Script Analyzer (CUE Engine)",
                readiness: 0,
                storyPoints: 23,
                priority: "medium",
                sprints: "2",
                keyBlockers: "NLP/AI implementation, phrase detection",
                stories: [
                    {
                        id: "8.1",
                        title: "Detect Limiting Language",
                        description: "Upload meeting notes, system flags 'had to choose' and suggests reframes",
                        readiness: 0,
                        sp: 13,
                        priority: "medium",
                        acceptanceCriteria: [
                            { text: "Phrase detection", status: "missing", readiness: 0 },
                            { text: "Reframe suggestions", status: "missing", readiness: 0 },
                            { text: "Inline citations", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "8.2",
                        title: "Coaching Prompts",
                        description: "Coaching prompts like 'What would it look like if both were true?'",
                        readiness: 0,
                        sp: 5,
                        priority: "low",
                        acceptanceCriteria: [
                            { text: "Prompt library", status: "missing", readiness: 0 },
                            { text: "Copy-into-agenda", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "8.3",
                        title: "Export Flagged Language",
                        description: "Export flagged language for training",
                        readiness: 0,
                        sp: 5,
                        priority: "low",
                        acceptanceCriteria: [
                            { text: "CSV export", status: "missing", readiness: 0 },
                            { text: "Per-meeting summary", status: "missing", readiness: 0 }
                        ]
                    }
                ]
            },
            {
                number: 9,
                name: "Rising-Gen Journey Builder",
                readiness: 11,
                storyPoints: 26,
                priority: "medium",
                sprints: "2",
                keyBlockers: "Journal table, mentor system, privacy wall",
                stories: [
                    {
                        id: "9.1",
                        title: "Discovery Prompts & Journal",
                        description: "Pick 1-2 discover prompts and log strengths to test",
                        readiness: 20,
                        sp: 8,
                        priority: "medium",
                        acceptanceCriteria: [
                            { text: "Prompt bank", status: "missing", readiness: 0 },
                            { text: "Journal", status: "missing", readiness: 0 },
                            { text: "Privacy controls", status: "partial", readiness: 60 }
                        ]
                    },
                    {
                        id: "9.2",
                        title: "Co-Design Experience",
                        description: "Co-design 6-month experience with first step",
                        readiness: 13,
                        sp: 10,
                        priority: "medium",
                        acceptanceCriteria: [
                            { text: "Goal/step/date", status: "partial", readiness: 40 },
                            { text: "Mentor tag", status: "missing", readiness: 0 },
                            { text: "Check-ins", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "9.3",
                        title: "Anonymized Progress Heatmaps",
                        description: "See anonymized progress heatmaps, not private journals",
                        readiness: 0,
                        sp: 8,
                        priority: "low",
                        acceptanceCriteria: [
                            { text: "Privacy wall", status: "missing", readiness: 0 },
                            { text: "Aggregate reporting", status: "missing", readiness: 0 }
                        ]
                    }
                ]
            },
            {
                number: 10,
                name: "Constraints Canvas & Innovation",
                readiness: 11,
                storyPoints: 23,
                priority: "low",
                sprints: "2",
                keyBlockers: "Constraint model, sprint templates",
                stories: [
                    {
                        id: "10.1",
                        title: "Capture Constraints as Ingredients",
                        description: "Capture constraints and convert to ingredients",
                        readiness: 0,
                        sp: 10,
                        priority: "low",
                        acceptanceCriteria: [
                            { text: "Constraint types", status: "missing", readiness: 0 },
                            { text: "Sprint template", status: "missing", readiness: 0 },
                            { text: "Bake-off option", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "10.2",
                        title: "Submit & Vote Solutions",
                        description: "Submit solutions that respect constraints and vote",
                        readiness: 33,
                        sp: 8,
                        priority: "low",
                        acceptanceCriteria: [
                            { text: "Submission slots", status: "missing", readiness: 0 },
                            { text: "Peer voting", status: "partial", readiness: 40 },
                            { text: "Tie to decision registry", status: "partial", readiness: 60 }
                        ]
                    },
                    {
                        id: "10.3",
                        title: "Show Before/After",
                        description: "Show how constraints unlocked options",
                        readiness: 0,
                        sp: 5,
                        priority: "low",
                        acceptanceCriteria: [
                            { text: "Before/after board", status: "missing", readiness: 0 },
                            { text: "Lessons learned", status: "missing", readiness: 0 }
                        ]
                    }
                ]
            },
            {
                number: 11,
                name: "Shareholder Agreement Workbench",
                readiness: 12,
                storyPoints: 42,
                priority: "medium",
                sprints: "3",
                keyBlockers: "Simulation engine, cap table, clause library",
                stories: [
                    {
                        id: "11.1",
                        title: "Assemble Draft from Boilerplates",
                        description: "Assemble draft using pre-emption, tag-along, cap boilerplates",
                        readiness: 13,
                        sp: 13,
                        priority: "medium",
                        acceptanceCriteria: [
                            { text: "Clause catalog", status: "partial", readiness: 40 },
                            { text: "Jurisdiction tags", status: "missing", readiness: 0 },
                            { text: "Versions", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "11.2",
                        title: "Simulate Exit Scenarios",
                        description: "Simulate partial exit or concerted-action trigger",
                        readiness: 0,
                        sp: 21,
                        priority: "low",
                        acceptanceCriteria: [
                            { text: "Scenario inputs", status: "missing", readiness: 0 },
                            { text: "Cap-table impact", status: "missing", readiness: 0 },
                            { text: "Redline diffs", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "11.3",
                        title: "Renegotiation & Sunset",
                        description: "Add renegotiation clause and sunset review timer",
                        readiness: 23,
                        sp: 8,
                        priority: "low",
                        acceptanceCriteria: [
                            { text: "Clause parameters", status: "partial", readiness: 20 },
                            { text: "Auto review date", status: "missing", readiness: 0 },
                            { text: "Alerts", status: "partial", readiness: 50 }
                        ]
                    }
                ]
            },
            {
                number: 12,
                name: "Investment & Impact Governance",
                readiness: 14,
                storyPoints: 33,
                priority: "medium",
                sprints: "2-3",
                keyBlockers: "Template system, impact dashboard, co-investor registry",
                stories: [
                    {
                        id: "12.1",
                        title: "Standardized Deal Memos",
                        description: "Standardize deal memos and voting thresholds per ticket size",
                        readiness: 20,
                        sp: 10,
                        priority: "medium",
                        acceptanceCriteria: [
                            { text: "Templates", status: "missing", readiness: 0 },
                            { text: "Size tiers", status: "missing", readiness: 0 },
                            { text: "Quorum/vote rules", status: "partial", readiness: 60 }
                        ]
                    },
                    {
                        id: "12.2",
                        title: "Tag & Track Impact Deals",
                        description: "Tag deal as impact (renewable, education) and attach metrics",
                        readiness: 23,
                        sp: 13,
                        priority: "medium",
                        acceptanceCriteria: [
                            { text: "Sector tags", status: "partial", readiness: 40 },
                            { text: "KPI fields", status: "partial", readiness: 30 },
                            { text: "Impact dashboard", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "12.3",
                        title: "Club-Deal Partner Registry",
                        description: "Track club-deal partners and rights",
                        readiness: 0,
                        sp: 10,
                        priority: "low",
                        acceptanceCriteria: [
                            { text: "Co-investor registry", status: "missing", readiness: 0 },
                            { text: "Contact & rights matrix", status: "missing", readiness: 0 }
                        ]
                    }
                ]
            },
            {
                number: 13,
                name: "Philanthropy & Legacy Workspace",
                readiness: 15,
                storyPoints: 24,
                priority: "medium",
                sprints: "2",
                keyBlockers: "Policy linkage, KPI aggregation, values mapping",
                stories: [
                    {
                        id: "13.1",
                        title: "Publish Funding Policies",
                        description: "Publish funding policies and cycles tied to constitution",
                        readiness: 30,
                        sp: 8,
                        priority: "medium",
                        acceptanceCriteria: [
                            { text: "Policy â†’ application linkage", status: "missing", readiness: 0 },
                            { text: "Calendar", status: "partial", readiness: 40 },
                            { text: "Reminders", status: "partial", readiness: 50 }
                        ]
                    },
                    {
                        id: "13.2",
                        title: "Outcome Reports",
                        description: "Produce outcome reports against stated goals",
                        readiness: 15,
                        sp: 8,
                        priority: "medium",
                        acceptanceCriteria: [
                            { text: "KPI rollups", status: "partial", readiness: 30 },
                            { text: "Export", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "13.3",
                        title: "Values Mapping",
                        description: "Review governance fit with family values",
                        readiness: 0,
                        sp: 8,
                        priority: "low",
                        acceptanceCriteria: [
                            { text: "Values mapping", status: "missing", readiness: 0 },
                            { text: "Variance notes", status: "missing", readiness: 0 }
                        ]
                    }
                ]
            },
            {
                number: 14,
                name: "Knowledge Base & Multi-Space",
                readiness: 15,
                storyPoints: 28,
                priority: "high",
                sprints: "2",
                keyBlockers: "Workspace model, threading, scope filter",
                stories: [
                    {
                        id: "14.1",
                        title: "Multi-Space Announcements",
                        description: "Publish one announcement to Board and Family Council simultaneously",
                        readiness: 25,
                        sp: 10,
                        priority: "high",
                        acceptanceCriteria: [
                            { text: "Multi-space selector", status: "missing", readiness: 0 },
                            { text: "Audience preview", status: "missing", readiness: 0 },
                            { text: "Read receipts", status: "complete", readiness: 75 }
                        ]
                    },
                    {
                        id: "14.2",
                        title: "Threaded Q&A",
                        description: "Run Q&A threads instead of top-down memos",
                        readiness: 0,
                        sp: 10,
                        priority: "medium",
                        acceptanceCriteria: [
                            { text: "Threaded Q&A", status: "missing", readiness: 0 },
                            { text: "Upvote", status: "missing", readiness: 0 },
                            { text: "Unresolved flag", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "14.3",
                        title: "Scope-Based Content Filtering",
                        description: "See only items shared to my space",
                        readiness: 20,
                        sp: 8,
                        priority: "high",
                        acceptanceCriteria: [
                            { text: "Scope filter", status: "missing", readiness: 0 },
                            { text: "Permission badge", status: "partial", readiness: 40 }
                        ]
                    }
                ]
            },
            {
                number: 15,
                name: "Cross-Functional Integration",
                readiness: 10,
                storyPoints: 62,
                priority: "medium",
                sprints: "4-5",
                keyBlockers: "Co-investor model, shared taxonomy, constraint system, cycle-time analytics",
                stories: [
                    {
                        id: "15.1",
                        title: "Club-Deal Rights & Cap Alerts",
                        description: "Log co-investor rights and notify council before crossing cap",
                        readiness: 0,
                        sp: 26,
                        priority: "medium",
                        acceptanceCriteria: [
                            { text: "Rights matrix", status: "missing", readiness: 0 },
                            { text: "Threshold alerts", status: "missing", readiness: 0 },
                            { text: "Compliance record", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "15.2",
                        title: "Impact Taxonomy Mapping",
                        description: "Map grants to impact sectors used in IC impact reporting",
                        readiness: 10,
                        sp: 18,
                        priority: "medium",
                        acceptanceCriteria: [
                            { text: "Shared taxonomy", status: "partial", readiness: 20 },
                            { text: "Cross-workspace rollup", status: "missing", readiness: 0 }
                        ]
                    },
                    {
                        id: "15.3",
                        title: "Constraint Policy & Cycle-Time Testing",
                        description: "Encode 'unanimous sign-off' as constraint and test decision latency impact",
                        readiness: 20,
                        sp: 18,
                        priority: "low",
                        acceptanceCriteria: [
                            { text: "Constraint toggle", status: "partial", readiness: 10 },
                            { text: "Cycle-time analytics", status: "partial", readiness: 30 }
                        ]
                    }
                ]
            }
        ];

        // Dependencies between blocks
        const dependencies = [
            { from: 1, to: 2, reason: "Workspace model needed for guest access" },
            { from: 1, to: 14, reason: "Workspace model enables multi-space" },
            { from: 2, to: 3, reason: "Constitution clauses link to decisions" },
            { from: 5, to: 4, reason: "Analytics infrastructure for accountability dashboard" },
            { from: 5, to: 15, reason: "Analytics needed for cycle-time tracking" },
            { from: 1, to: 5, reason: "Role management affects engagement tracking" },
            { from: 12, to: 15, reason: "Investment infrastructure for club-deal rights" },
            { from: 13, to: 15, reason: "Philanthropy taxonomy for impact mapping" }
        ];

        // State
        let currentView = 'dashboard';
        let sortColumn = null;
        let sortDirection = 'asc';
        let filteredBlocks = [...blocksData];

        // Initialize
        function init() {
            renderHeatmap();
            renderBlocksTable();
            renderDependencyGraph();
        }

        // View Management
        function showView(viewName) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));

            document.getElementById(viewName).classList.add('active');
            event.target.classList.add('active');

            currentView = viewName;
        }

        // Render Heatmap
        function renderHeatmap() {
            const container = document.getElementById('heatmapGrid');
            container.innerHTML = '';

            blocksData.forEach(block => {
                const cell = document.createElement('div');
                cell.className = 'heatmap-cell';

                // Color based on readiness
                if (block.readiness < 15) {
                    cell.classList.add('readiness-critical');
                } else if (block.readiness < 30) {
                    cell.classList.add('readiness-low');
                } else if (block.readiness < 70) {
                    cell.classList.add('readiness-medium');
                } else {
                    cell.classList.add('readiness-high');
                }

                cell.innerHTML = `
                    <div class="heatmap-cell-number">Block ${block.number}</div>
                    <div class="heatmap-cell-name">${block.name}</div>
                    <div class="heatmap-cell-readiness">${block.readiness}%</div>
                    <div class="heatmap-cell-sp">${block.storyPoints} SP</div>
                `;

                cell.onclick = () => showBlockDetails(block.number);
                container.appendChild(cell);
            });
        }

        // Render Blocks Table
        function renderBlocksTable() {
            const tbody = document.getElementById('blocksTableBody');
            tbody.innerHTML = '';

            filteredBlocks.forEach(block => {
                const tr = document.createElement('tr');
                tr.onclick = () => showBlockDetails(block.number);

                const priorityClass = `priority-${block.priority}`;
                const priorityLabel = {
                    'critical': 'ðŸ”´ Critical',
                    'high': 'ðŸŸ¡ High',
                    'medium': 'ðŸŸ  Medium',
                    'low': 'ðŸŸ¢ Low'
                }[block.priority];

                tr.innerHTML = `
                    <td><span class="block-number">${block.number}</span></td>
                    <td><span class="block-name">${block.name}</span></td>
                    <td>
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: ${block.readiness}%">
                                ${block.readiness}%
                            </div>
                        </div>
                    </td>
                    <td><strong>${block.storyPoints}</strong> SP</td>
                    <td><span class="priority-badge ${priorityClass}">${priorityLabel}</span></td>
                    <td>${block.stories.length} stories</td>
                `;

                tbody.appendChild(tr);
            });
        }

        // Filter Blocks
        function filterBlocks() {
            const priorityFilter = document.getElementById('priorityFilter').value;
            const readinessFilter = document.getElementById('readinessFilter').value;
            const searchText = document.getElementById('searchInput').value.toLowerCase();

            filteredBlocks = blocksData.filter(block => {
                // Priority filter
                if (priorityFilter !== 'all' && block.priority !== priorityFilter) {
                    return false;
                }

                // Readiness filter
                if (readinessFilter !== 'all') {
                    const [min, max] = readinessFilter.split('-').map(Number);
                    if (block.readiness < min || block.readiness > max) {
                        return false;
                    }
                }

                // Search filter
                if (searchText && !block.name.toLowerCase().includes(searchText) &&
                    !block.keyBlockers.toLowerCase().includes(searchText)) {
                    return false;
                }

                return true;
            });

            renderBlocksTable();
        }

        // Sort Table
        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'asc';
            }

            filteredBlocks.sort((a, b) => {
                let aVal, bVal;

                switch (column) {
                    case 'number':
                        aVal = a.number;
                        bVal = b.number;
                        break;
                    case 'name':
                        aVal = a.name;
                        bVal = b.name;
                        break;
                    case 'readiness':
                        aVal = a.readiness;
                        bVal = b.readiness;
                        break;
                    case 'sp':
                        aVal = a.storyPoints;
                        bVal = b.storyPoints;
                        break;
                    case 'priority':
                        const priorityOrder = { 'critical': 0, 'high': 1, 'medium': 2, 'low': 3 };
                        aVal = priorityOrder[a.priority];
                        bVal = priorityOrder[b.priority];
                        break;
                }

                if (sortDirection === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });

            // Update sort indicators
            document.querySelectorAll('.blocks-table th').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });

            const th = event.target;
            th.classList.add(sortDirection === 'asc' ? 'sort-asc' : 'sort-desc');

            renderBlocksTable();
        }

        // Show Block Details Modal
        function showBlockDetails(blockNumber) {
            const block = blocksData.find(b => b.number === blockNumber);
            if (!block) return;

            const modal = document.getElementById('blockModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            const priorityClass = `priority-${block.priority}`;
            const priorityLabel = {
                'critical': 'ðŸ”´ Critical',
                'high': 'ðŸŸ¡ High',
                'medium': 'ðŸŸ  Medium',
                'low': 'ðŸŸ¢ Low'
            }[block.priority];

            modalTitle.textContent = `Block ${block.number}: ${block.name}`;

            let storiesHTML = '';
            block.stories.forEach(story => {
                const storyReadinessClass = story.readiness < 15 ? 'readiness-critical' :
                                          story.readiness < 30 ? 'readiness-low' :
                                          story.readiness < 70 ? 'readiness-medium' : 'readiness-high';

                let criteriaHTML = '';
                story.acceptanceCriteria.forEach(ac => {
                    const statusClass = ac.status === 'complete' ? 'status-complete' :
                                       ac.status === 'partial' ? 'status-partial' : 'status-missing';
                    const statusLabel = ac.status === 'complete' ? 'âœ“ Complete' :
                                       ac.status === 'partial' ? 'âš  Partial' : 'âœ— Missing';

                    criteriaHTML += `
                        <li class="criteria-item">
                            <span>${ac.text}</span>
                            <span class="criteria-status ${statusClass}">${statusLabel} (${ac.readiness}%)</span>
                        </li>
                    `;
                });

                storiesHTML += `
                    <div class="user-story">
                        <div class="user-story-header">
                            <div class="user-story-title">${story.id}: ${story.title}</div>
                            <div class="user-story-meta">
                                <span class="user-story-sp">${story.sp} SP</span>
                                <span class="user-story-readiness ${storyReadinessClass}">${story.readiness}%</span>
                            </div>
                        </div>
                        <div class="user-story-description">${story.description}</div>
                        <div class="user-story-criteria">
                            <div class="criteria-title">Acceptance Criteria</div>
                            <ul class="criteria-list">${criteriaHTML}</ul>
                        </div>
                    </div>
                `;
            });

            modalBody.innerHTML = `
                <div class="block-info-grid">
                    <div class="block-info-item">
                        <div class="block-info-label">Readiness</div>
                        <div class="block-info-value">${block.readiness}%</div>
                    </div>
                    <div class="block-info-item">
                        <div class="block-info-label">Story Points</div>
                        <div class="block-info-value">${block.storyPoints} SP</div>
                    </div>
                    <div class="block-info-item">
                        <div class="block-info-label">Timeline</div>
                        <div class="block-info-value">${block.sprints}</div>
                    </div>
                    <div class="block-info-item">
                        <div class="block-info-label">Priority</div>
                        <div class="block-info-value">
                            <span class="priority-badge ${priorityClass}" style="font-size: 12px;">${priorityLabel}</span>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 24px;">
                    <div style="font-size: 13px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px;">
                        KEY BLOCKERS
                    </div>
                    <div style="padding: 12px; background: var(--light-gray); border-radius: 6px; font-size: 13px;">
                        ${block.keyBlockers}
                    </div>
                </div>

                <div class="user-stories">
                    <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">
                        User Stories (${block.stories.length})
                    </h3>
                    ${storiesHTML}
                </div>
            `;

            modal.classList.add('active');
        }

        // Close Modal
        function closeModal(event) {
            if (!event || event.target.id === 'blockModal') {
                document.getElementById('blockModal').classList.remove('active');
            }
        }

        // Render Dependency Graph
        function renderDependencyGraph() {
            const container = document.getElementById('graphContainer');
            const svg = document.getElementById('dependencyGraph');

            const width = Math.max(container.clientWidth, 1200);
            const height = 800;

            svg.setAttribute('width', width);
            svg.setAttribute('height', height);
            svg.setAttribute('viewBox', `0 0 ${width} ${height}`);

            // Create node positions (grid layout)
            const cols = 5;
            const rows = Math.ceil(blocksData.length / cols);
            const nodeWidth = 120;
            const nodeHeight = 70;
            const spacingX = 50;
            const spacingY = 100;
            const startX = (width - (cols * nodeWidth + (cols - 1) * spacingX)) / 2;
            const startY = 50;

            const nodes = blocksData.map((block, i) => {
                const col = i % cols;
                const row = Math.floor(i / cols);
                return {
                    ...block,
                    x: startX + col * (nodeWidth + spacingX) + nodeWidth / 2,
                    y: startY + row * (nodeHeight + spacingY) + nodeHeight / 2
                };
            });

            // Clear SVG
            svg.innerHTML = '';

            // Create defs for markers
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            svg.appendChild(defs);

            // Draw edges with arrows
            dependencies.forEach(dep => {
                const from = nodes.find(n => n.number === dep.from);
                const to = nodes.find(n => n.number === dep.to);

                if (from && to) {
                    const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');

                    // Create unique marker for this edge
                    const markerId = `arrow-${dep.from}-${dep.to}`;
                    const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
                    marker.setAttribute('id', markerId);
                    marker.setAttribute('markerWidth', '10');
                    marker.setAttribute('markerHeight', '10');
                    marker.setAttribute('refX', '8');
                    marker.setAttribute('refY', '3');
                    marker.setAttribute('orient', 'auto');
                    marker.setAttribute('markerUnits', 'strokeWidth');

                    const arrowPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    arrowPath.setAttribute('d', 'M0,0 L0,6 L9,3 z');
                    arrowPath.setAttribute('fill', '#5a7fa3');
                    arrowPath.setAttribute('opacity', '0.6');
                    marker.appendChild(arrowPath);
                    defs.appendChild(marker);

                    // Draw curved path
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    const midX = (from.x + to.x) / 2;
                    const midY = (from.y + to.y) / 2;
                    const controlY = midY - 40;

                    const d = `M ${from.x} ${from.y} Q ${midX} ${controlY} ${to.x} ${to.y}`;
                    path.setAttribute('d', d);
                    path.setAttribute('stroke', '#5a7fa3');
                    path.setAttribute('stroke-width', '2');
                    path.setAttribute('fill', 'none');
                    path.setAttribute('opacity', '0.5');
                    path.setAttribute('marker-end', `url(#${markerId})`);

                    g.appendChild(path);
                    svg.appendChild(g);
                }
            });

            // Draw nodes
            nodes.forEach(node => {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                g.setAttribute('class', `graph-node priority-${node.priority}`);
                g.style.cursor = 'pointer';
                g.onclick = () => showBlockDetails(node.number);

                // Background rect
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', node.x - nodeWidth/2);
                rect.setAttribute('y', node.y - nodeHeight/2);
                rect.setAttribute('width', nodeWidth);
                rect.setAttribute('height', nodeHeight);
                rect.setAttribute('rx', '6');

                // Color based on priority
                const colors = {
                    'critical': '#dc3545',
                    'high': '#ffc107',
                    'medium': '#17a2b8',
                    'low': '#6c757d'
                };
                rect.setAttribute('fill', colors[node.priority] || '#6c757d');
                rect.setAttribute('stroke', '#fff');
                rect.setAttribute('stroke-width', '2');
                g.appendChild(rect);

                // Block number text
                const text1 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text1.setAttribute('x', node.x);
                text1.setAttribute('y', node.y - 15);
                text1.setAttribute('text-anchor', 'middle');
                text1.setAttribute('fill', 'white');
                text1.setAttribute('font-size', '11');
                text1.setAttribute('font-weight', '600');
                text1.textContent = `Block ${node.number}`;
                g.appendChild(text1);

                // Readiness percentage
                const text2 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text2.setAttribute('x', node.x);
                text2.setAttribute('y', node.y + 5);
                text2.setAttribute('text-anchor', 'middle');
                text2.setAttribute('fill', 'white');
                text2.setAttribute('font-size', '16');
                text2.setAttribute('font-weight', '700');
                text2.textContent = `${node.readiness}%`;
                g.appendChild(text2);

                // Story points
                const text3 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text3.setAttribute('x', node.x);
                text3.setAttribute('y', node.y + 22);
                text3.setAttribute('text-anchor', 'middle');
                text3.setAttribute('fill', 'white');
                text3.setAttribute('font-size', '10');
                text3.setAttribute('opacity', '0.9');
                text3.textContent = `${node.storyPoints} SP`;
                g.appendChild(text3);

                svg.appendChild(g);
            });
        }

        // Initialize on load
        window.addEventListener('load', init);
        window.addEventListener('resize', () => {
            if (currentView === 'dependencies') {
                renderDependencyGraph();
            }
        });
    </script>
</body>
</html>
