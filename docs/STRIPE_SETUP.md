# Stripe Integration Setup

## ะัััััะน ััะฐัั (5 ะผะธะฝัั)

### 1. ะกะพะทะดะฐะนัะต Stripe ะฐะบะบะฐัะฝั

ะัะปะธ ะตัั ะฝะตั, ะทะฐัะตะณะธัััะธััะนัะตัั ะฝะฐ [dashboard.stripe.com](https://dashboard.stripe.com)

### 2. ะะพะปััะธัะต ัะตััะพะฒัะต ะบะปััะธ

ะะตัะตะนะดะธัะต ะฒ [API Keys](https://dashboard.stripe.com/test/apikeys) ะธ ัะบะพะฟะธััะนัะต:
- **Publishable key**: `pk_test_...`
- **Secret key**: `sk_test_...`

### 3. ะะฐะฟัััะธัะต ะฐะฒัะพะผะฐัะธัะตัะบัั ะฝะฐัััะพะนะบั

```bash
# ะะพะฑะฐะฒััะต Secret Key ะฒ .env.local
echo "STRIPE_SECRET_KEY=sk_test_YOUR_KEY" >> .env.local

# ะะฐะฟัััะธัะต ัะบัะธะฟั ะฝะฐัััะพะนะบะธ
npm run stripe:setup
```

ะกะบัะธะฟั ะฐะฒัะพะผะฐัะธัะตัะบะธ:
- โ ะกะพะทะดะฐัั Products (Standard, Premium)
- โ ะกะพะทะดะฐัั Prices ะดะปั ะบะฐะถะดะพะณะพ ะฟะปะฐะฝะฐ
- โ ะะฐัััะพะธั Customer Portal
- โ ะกะณะตะฝะตัะธััะตั `.env.stripe` ั ะฟะตัะตะผะตะฝะฝัะผะธ ะพะบััะถะตะฝะธั

### 4. ะกะบะพะฟะธััะนัะต ะฟะตัะตะผะตะฝะฝัะต ะฒ .env.local

```bash
# ะกะบะพะฟะธััะนัะต ัะพะดะตัะถะธะผะพะต .env.stripe ะฒ .env.local
cat .env.stripe >> .env.local
```

ะะฐัะตะผ ะพะฑะฝะพะฒะธัะต `NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY` ะฝะฐ ัะตะฐะปัะฝัะน ะบะปัั ะธะท Dashboard.

### 5. ะะฐัััะพะนัะต Webhook (ะดะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ)

```bash
# ะฃััะฐะฝะพะฒะธัะต Stripe CLI
brew install stripe/stripe-cli/stripe

# ะะฒัะพัะธะทัะนัะตัั
stripe login

# ะะฐะฟัััะธัะต ัะพัะฒะฐัะดะธะฝะณ webhooks
npm run stripe:listen
```

ะกะบะพะฟะธััะนัะต webhook secret (`whsec_...`) ะฒ `.env.local`:
```
STRIPE_WEBHOOK_SECRET=whsec_...
```

## ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

```env
# ะะฑัะทะฐัะตะปัะฝัะต
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_xxx
STRIPE_SECRET_KEY=sk_test_xxx
STRIPE_WEBHOOK_SECRET=whsec_xxx

# Price IDs (ัะพะทะดะฐัััั ะฐะฒัะพะผะฐัะธัะตัะบะธ)
STRIPE_STANDARD_PRICE_ID=price_xxx
STRIPE_PREMIUM_PRICE_ID=price_xxx
STRIPE_ADDITIONAL_PORTAL_PRICE_ID=price_xxx
```

## ะขะตััะพะฒัะต ะบะฐััั

| ะะฐััะฐ | ะะพะผะตั | ะะฟะธัะฐะฝะธะต |
|-------|-------|----------|
| โ ะฃัะฟะตัะฝะฐั ะพะฟะปะฐัะฐ | `4242 4242 4242 4242` | ะัะฑัะต ะดะฐะฝะฝัะต |
| โ ะัะบะปะพะฝัะฝะฝะฐั | `4000 0000 0000 0002` | ะะฐััะฐ ะพัะบะปะพะฝะตะฝะฐ |
| โ๏ธ ะขัะตะฑัะตั 3DS | `4000 0025 0000 3155` | 3D Secure |
| ๐ณ ะะตะดะพััะฐัะพัะฝะพ ััะตะดััะฒ | `4000 0000 0000 9995` | Insufficient funds |

ะะฐัะฐ: ะปัะฑะฐั ะฑัะดััะฐั, CVC: ะปัะฑัะต 3 ัะธััั, ZIP: ะปัะฑะพะน 5-ะทะฝะฐัะฝัะน

## Webhook Events

ะะฑัะฐะฑะฐััะฒะฐะตะผัะต ัะพะฑััะธั ะฒ `/api/stripe/webhook`:

| Event | ะะฟะธัะฐะฝะธะต |
|-------|----------|
| `checkout.session.completed` | ะฃัะฟะตัะฝะฐั ะพะฟะปะฐัะฐ ะฟะพะดะฟะธัะบะธ |
| `customer.subscription.updated` | ะะทะผะตะฝะตะฝะธะต ะฟะพะดะฟะธัะบะธ |
| `customer.subscription.deleted` | ะัะผะตะฝะฐ ะฟะพะดะฟะธัะบะธ |
| `invoice.payment_failed` | ะะตัะดะฐัะฝัะน ะฟะปะฐััะถ |

## ะะปะฐะฝั ะฟะพะดะฟะธัะบะธ

### Standard Consultant ($149/ะผะตั)
- ะะพัััะฟ ะบ ะผะฐัะบะตัะฟะปะตะนัั ัะตะผะตะน
- ะะตะพะณัะฐะฝะธัะตะฝะฝัะต ะบะพะฝััะปััะฐัะธะธ
- ะะฐะทะพะฒะฐั ะฐะฝะฐะปะธัะธะบะฐ
- **ะะตะปัะทั ัะพะทะดะฐะฒะฐัั Family Portals**

### Premium Consultant ($599/ะผะตั)
- ะัั ะธะท Standard
- ะะพ 3 Family Portals (ะฒะบะปััะตะฝะพ)
- ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะฟะพััะฐะปั: +$49/ะผะตั ะบะฐะถะดัะน
- ะะฐััะธัะตะฝะฝะฐั ะฐะฝะฐะปะธัะธะบะฐ
- ะัะธะพัะธัะตัะฝะฐั ะฟะพะดะดะตัะถะบะฐ

## ะะตะถะธะผั ัะฐะฑะพัั

### Mock Mode (ะฟะพ ัะผะพะปัะฐะฝะธั)
```env
NEXT_PUBLIC_STRIPE_MODE=mock
```
- ะะพะดะฟะธัะบะธ ัะพะทะดะฐัััั ะฝะฐะฟััะผัั ะฒ ะฑะฐะทะต ะดะฐะฝะฝัั
- ะะต ััะตะฑัะตั ัะตะฐะปัะฝะพะณะพ Stripe
- ะะพะดัะพะดะธั ะดะปั ัะฐะทัะฐะฑะพัะบะธ ะธ ะดะตะผะพ

### Live Mode
```env
NEXT_PUBLIC_STRIPE_MODE=live
```
- ะะตะฐะปัะฝัะต ะฟะปะฐัะตะถะธ ัะตัะตะท Stripe
- ะขัะตะฑัะตั ะฝะฐัััะพะตะฝะฝัะต API ะบะปััะธ ะธ webhooks
- ะะปั ะฟัะพะดะฐะบัะตะฝะฐ

## ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโ
โ  Frontend       โโโโโโถโ  API Routes      โโโโโโถโ  Stripe API โ
โ  (subscription  โ     โ  /api/stripe/*   โ     โ             โ
โ   page)         โ     โ                  โ     โ             โ
โโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโ
                               โ
                               โผ
                        โโโโโโโโโโโโโโโโโโโโ
                        โ  Supabase        โ
                        โ  (subscriptions  โ
                        โ   table)         โ
                        โโโโโโโโโโโโโโโโโโโโ
```

## FAQ

### ะะฐะบ ัะตััะธัะพะฒะฐัั webhook ะปะพะบะฐะปัะฝะพ?

```bash
# ะขะตัะผะธะฝะฐะป 1: ะทะฐะฟัััะธัะต ะฟัะธะปะพะถะตะฝะธะต
npm run dev

# ะขะตัะผะธะฝะฐะป 2: ะทะฐะฟัััะธัะต stripe listen
npm run stripe:listen
```

### ะะฐะบ ัะฑัะพัะธัั ัะตััะพะฒัะต ะดะฐะฝะฝัะต?

ะ [Stripe Dashboard](https://dashboard.stripe.com/test/developers) โ Data โ Delete all test data

### ะะฐะบ ะฟะตัะตะนัะธ ะฝะฐ ะฑะพะตะฒะพะน ัะตะถะธะผ?

1. ะะบัะธะฒะธััะนัะต ะฐะบะบะฐัะฝั ะฒ Stripe Dashboard
2. ะะพะปััะธัะต ะฑะพะตะฒัะต ะบะปััะธ (`pk_live_`, `sk_live_`)
3. ะกะพะทะดะฐะนัะต Products/Prices ัะตัะตะท `npm run stripe:setup` ั ะฑะพะตะฒัะผ ะบะปััะพะผ
4. ะะฐัััะพะนัะต webhook endpoint ะฒ Dashboard
5. ะะฑะฝะพะฒะธัะต `.env.local` ั ะฑะพะตะฒัะผะธ ะบะปััะฐะผะธ

## ะกััะปะบะธ

- [Stripe Dashboard](https://dashboard.stripe.com)
- [Stripe CLI](https://stripe.com/docs/stripe-cli)
- [Stripe Testing](https://stripe.com/docs/testing)
- [Stripe Webhooks](https://stripe.com/docs/webhooks)
